<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9067024774549867"
     crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ã€Šäº‘æ¸ºä»™é€”ï¼šå‡¡å°˜ç¯‡ã€‹æ˜¯ä¸€ä¸ªç”±AIé©±åŠ¨çš„æ–‡å­—ä¿®ä»™æ²™ç›’æ¸¸æˆã€‚åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥ä½“éªŒä»å‡¡äººåˆ°ä»™å¸çš„å®Œæ•´ä¿®ä»™ä¹‹æ—…ï¼Œæ¢ç´¢å¹¿é˜”çš„äº‘æ¸ºå¤§é™†ï¼Œåšå‡ºä½ çš„é€‰æ‹©ï¼Œä¹¦å†™ä½ çš„ä¼ å¥‡ã€‚">
    <meta name="keywords" content="ä¿®ä»™, æ–‡å­—æ¸¸æˆ, MUD, AI, æ²™ç›’, å‡¡äººä¿®ä»™, äº‘æ¸ºå¤§é™†, è§’è‰²æ‰®æ¼”, RPG, äº’åŠ¨å°è¯´">
    <meta name="author" content="AIæ²™ç›’ä¸–ç•Œ">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://ai-game.jkai.de/">
    <meta property="og:title" content="äº‘æ¸ºä»™é€”ï¼šå‡¡å°˜ç¯‡ - AIé©±åŠ¨çš„æ²™ç›’ä¿®ä»™ä¸–ç•Œ">
    <meta property="og:description" content="å¼€å¯ä½ çš„ä¿®ä»™ä¹‹æ—…ï¼Œä»ä¸€ä»‹å‡¡äººåˆ°æŒæ§å¤©åœ°ï¼Œä½ çš„æ¯ä¸€æ­¥é€‰æ‹©éƒ½å°†é“¸å°±ç‹¬ä¸€æ— äºŒçš„ä¼ å¥‡ã€‚">
    <meta property="og:image" content="https://ai-game.jkai.de/preview-image.jpg">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://ai-game.jkai.de/">
    <meta property="twitter:title" content="äº‘æ¸ºä»™é€”ï¼šå‡¡å°˜ç¯‡ - AIé©±åŠ¨çš„æ²™ç›’ä¿®ä»™ä¸–ç•Œ">
    <meta property="twitter:description" content="å¼€å¯ä½ çš„ä¿®ä»™ä¹‹æ—…ï¼Œä»ä¸€ä»‹å‡¡äººåˆ°æŒæ§å¤©åœ°ï¼Œä½ çš„æ¯ä¸€æ­¥é€‰æ‹©éƒ½å°†é“¸å°±ç‹¬ä¸€æ— äºŒçš„ä¼ å¥‡ã€‚">
    <meta property="twitter:image" content="https://ai-game.jkai.de/preview-image.jpg">
    <title>äº‘æ¸ºä»™é€”ï¼šå‡¡å°˜ç¯‡ - AIæ²™ç›’ä¸–ç•Œ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --panda-color: #4ECDC4;
            --mushroom-color: #FF6B6B;
            --coriander-color: #06D6A0;
            --dark-bg: #1A1A2E;
            --darker-bg: #0D0D1A;
            --light-text: #F7F9F9;
            --pixel-border: #4ECDC4;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Press Start 2P', 'Courier New', monospace;
        }
        
        body {
            background: var(--dark-bg);
            color: var(--light-text);
            min-height: 100vh;
            padding: 20px;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(78, 205, 196, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(255, 107, 107, 0.1) 0%, transparent 20%);
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            min-height: 95vh;
        }
        
        header {
            text-align: center;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
            border-bottom: 4px dotted var(--pixel-border);
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 15px;
            color: var(--panda-color);
            text-shadow: 3px 3px 0 var(--mushroom-color), 
                         6px 6px 0 var(--coriander-color);
            letter-spacing: 2px;
            line-height: 1.3;
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: var(--pixel-border);
            margin-bottom: 15px;
        }
        
        .game-ui {
            display: grid;
            grid-template-columns: 3fr 1fr;
            gap: 20px;
            flex: 1;
        }
        
        .game-area {
            background: rgba(13, 13, 26, 0.8);
            border: 4px solid var(--pixel-border);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }
        
        .scene-container {
            position: relative;
            min-height: 300px;
            margin-bottom: 20px;
            border: 3px solid var(--pixel-border);
            border-radius: 5px;
            overflow: hidden;
            background: rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        #scene-img {
            max-width: 100%;
            max-height: 280px;
            border-radius: 4px;
            image-rendering: pixelated;
        }
        
        .story-text {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid var(--pixel-border);
            border-radius: 5px;
            padding: 20px;
            margin-bottom: 20px;
            font-size: 1.1rem;
            line-height: 1.6;
            min-height: 150px;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.7);
        }
        
        .choices-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .choice-btn {
            background: linear-gradient(145deg, #2a2a4a, #1f1f3a);
            border: 3px solid var(--pixel-border);
            color: var(--light-text);
            padding: 15px;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
            position: relative;
            overflow: hidden;
        }
        
        .choice-btn:hover {
            background: linear-gradient(145deg, #3a3a5a, #2f2f4a);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
        }
        
        .choice-btn:active {
            transform: translateY(1px);
        }
        
        .choice-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.2),
                transparent
            );
            transition: 0.5s;
        }
        
        .choice-btn:hover::before {
            left: 100%;
        }
        
        .skill-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 8px;
        }
        
        .stats-panel {
            background: rgba(13, 13, 26, 0.8);
            border: 4px solid var(--pixel-border);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .panel-title {
            font-size: 1.4rem;
            color: var(--pixel-border);
            text-align: center;
            margin-bottom: 15px;
            border-bottom: 2px dotted var(--pixel-border);
            padding-bottom: 10px;
        }
        
        .character-info {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 5px;
            padding: 15px;
            border: 2px solid var(--panda-color);
        }
        
        .char-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .char-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--panda-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            flex-shrink: 0;
        }
        
        .char-name {
            font-size: 1.4rem;
            color: var(--panda-color);
        }
        
        .health-bar {
            height: 20px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
            position: relative;
        }
        
        .health-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--panda-color), #ff8e8e);
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        
        .health-text {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .stat-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.4rem;
            color: var(--pixel-border);
        }
        
        .skills-container, .inventory-container, .achievement-container, .adventure-log-container {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 5px;
            padding: 15px;
        }

        .scrollable-content {
            max-height: 150px;
            overflow-y: auto;
            padding-right: 10px; /* for scrollbar */
        }
        
        .skills-container { border: 2px solid var(--mushroom-color); }
        .inventory-container { border: 2px solid var(--coriander-color); }
        .achievement-container { border: 2px solid gold; }
        .adventure-log-container { border: 2px solid var(--pixel-border); }
        
        .skill-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .skill-item {
            background: rgba(106, 13, 173, 0.3);
            padding: 10px;
            border-radius: 5px;
            border-left: 4px solid var(--mushroom-color);
        }
        
        .skill-name {
            color: var(--mushroom-color);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .items-grid {
            display: block;
            margin-top: 10px;
        }

        .item-text, .achievement-text {
            padding: 2px 5px;
            text-align: left;
            width: 100%;
        }
        
        .pixel-corner {
            position: absolute;
            width: 20px;
            height: 20px;
        }
        
        .pixel-corner.tl { top: 0; left: 0; border-top: 4px solid var(--pixel-border); border-left: 4px solid var(--pixel-border); }
        .pixel-corner.tr { top: 0; right: 0; border-top: 4px solid var(--pixel-border); border-right: 4px solid var(--pixel-border); }
        .pixel-corner.bl { bottom: 0; left: 0; border-bottom: 4px solid var(--pixel-border); border-left: 4px solid var(--pixel-border); }
        .pixel-corner.br { bottom: 0; right: 0; border-bottom: 4px solid var(--pixel-border); border-right: 4px solid var(--pixel-border); }
        
        .status-bar {
            display: flex;
            justify-content: space-around;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 5px;
            border: 2px solid var(--pixel-border);
        }
        
        .status-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .status-value {
            font-size: 1.4rem;
            color: var(--pixel-border);
        }
        
        .loading {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .loading.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(78, 205, 196, 0.3);
            border-top: 5px solid var(--pixel-border);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-size: 1.2rem;
            color: var(--pixel-border);
            text-align: center;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            margin-top: 20px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
            border-top: 2px dotted var(--pixel-border);
        }
        
        @media (max-width: 768px) {
            .game-ui { grid-template-columns: 1fr; }
            h1 { font-size: 2rem; }
            .choices-container { grid-template-columns: 1fr; }
        }
        
        .api-settings-container {
            background: var(--darker-bg);
            padding: 20px;
            margin-top: 20px;
            border: 2px solid var(--pixel-border);
            border-radius: 8px;
        }
        .api-settings {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr auto auto;
            gap: 15px;
            align-items: center;
        }
        .api-settings input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--pixel-border);
            color: var(--light-text);
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }
        .api-settings-select {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--pixel-border);
            color: var(--light-text);
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            width: 100%;
            cursor: pointer;
        }
        .api-settings-select option {
            background: var(--darker-bg);
            color: var(--light-text);
        }
        .api-settings button {
             background: var(--pixel-border);
             color: var(--darker-bg);
             border: none;
             padding: 10px 15px;
             border-radius: 4px;
             cursor: pointer;
             font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>äº‘æ¸ºä»™é€”ï¼šå‡¡å°˜ç¯‡</h1>
            <p class="subtitle">ä¸€ä¸ªç”±AIé©±åŠ¨çš„æ²™ç›’ä¿®ä»™ä¸–ç•Œ</p>
        </header>

        <div class="status-bar">
            <div class="status-item"><span>çµçŸ³</span><span class="status-value">50</span></div>
            <div class="status-item"><span>å£°æœ›</span><span class="status-value">0</span></div>
            <div class="status-item"><span>å¢ƒç•Œ</span><span class="status-value">å‡¡äºº</span></div>
        </div>

        <div class="game-ui">
            <div class="game-area">
                <div class="loading" id="loading">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">æ­£åœ¨ç”Ÿæˆæ–°çš„å†’é™©...</div>
                </div>
                <div class="scene-container">
                    <img id="scene-img" src="" alt="åœºæ™¯å›¾ç‰‡">
                </div>
                <div class="story-text" id="story-text">
                    ä½ ä»ä¸€ä¸ªæ‚ é•¿çš„æ¢¦å¢ƒä¸­æƒŠé†’ï¼Œæ¢¦é‡Œæ˜¯éœ“è™¹é—ªçƒçš„é’¢é“æ£®æ—ï¼Œæ˜¯æœªæ›¾å¬é—»çš„å–§åš£ä¸ç¹åã€‚ä½†çœ¼å‰ï¼Œå´æ˜¯å¤æœ´çš„æœ¨å±‹ã€æ‘‡æ›³çš„çƒ›ç«ã€‚çª—å¤–ï¼Œæœˆåå¦‚æ°´ï¼Œä»™é¹¤é•¿é¸£ï¼Œè¿œæ–¹å±±å³¦åœ¨äº‘é›¾ä¸­è‹¥éšè‹¥ç°ã€‚ä½ æ„è¯†åˆ°ï¼Œä½ æ¥åˆ°äº†ä¸€ä¸ªåä¸ºâ€œäº‘æ¸ºå¤§é™†â€çš„ä¿®ä»™ä¸–ç•Œã€‚åœ¨è¿™é‡Œï¼Œå‡¡äººäº¦å¯å‡­å€Ÿæœºç¼˜ä¸æ¯…åŠ›ï¼Œæ„Ÿæ‚Ÿå¤©åœ°ï¼Œé€†å¤©æ”¹å‘½ï¼Œè¸ä¸Šè¿½å¯»æ°¸æ’çš„é“è·¯ã€‚ä¸€ä¸ªç¥ç§˜çš„å£°éŸ³åœ¨ä½ è„‘æµ·ä¸­å›å“ï¼šâ€œæ­¤ä¹ƒå¤©å‘½æ‰€å½’ï¼Œäº¦æ˜¯æ±ä¹‹æŠ‰æ‹©ã€‚é€‰æ‹©ä½ çš„èµ·ç‚¹ï¼Œç»‡å°±ä½ çš„ä¼ å¥‡å§ã€‚â€
                </div>
                <div class="choices-container" id="choices-container">
                    <button class="choice-btn" data-choice="orphan">ğŸ“œ å­¤å„¿å‡ºèº«ï¼Œèº«ä¸–æˆè°œ</button>
                    <button class="choice-btn" data-choice="farmer">ğŸŒ¾ å†œå®¶å­å¼Ÿï¼Œæ·³æœ´åšæ¯…</button>
                    <button class="choice-btn" data-choice="scholar">ğŸ“š ä¹¦é¦™é—¨ç¬¬ï¼Œèªæ…§è¿‡äºº</button>
                    <button class="choice-btn" data-choice="merchant">ğŸ’° å•†è´¾ä¹‹åï¼Œç²¾äºè®¡ç®—</button>
                </div>
            </div>
            <div class="stats-panel">
                <h2 class="panel-title">è§’è‰²çŠ¶æ€</h2>
                <div class="character-info">
                    <div class="char-header">
                        <div class="char-icon">ğŸ‘¤</div>
                        <div id="char-name" class="char-name">å†’é™©è€…</div>
                    </div>
                    <div class="health-bar">
                        <div id="health-bar" class="health-fill"></div>
                        <div id="health-text" class="health-text">HP: 100/100</div>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-item"><span>æ”»å‡»</span><span id="attack-value" class="stat-value">5</span></div>
                        <div class="stat-item"><span>é˜²å¾¡</span><span id="defense-value" class="stat-value">5</span></div>
                        <div class="stat-item"><span>èº«æ³•</span><span id="agility-value" class="stat-value">5</span></div>
                        <div class="stat-item"><span>é­…åŠ›</span><span id="charm-value" class="stat-value">5</span></div>
                    </div>
                </div>
                <div class="skills-container">
                    <h3 class="panel-title">ç¥é€š/åŠŸæ³•</h3>
                    <div id="skills-list" class="scrollable-content"></div>
                </div>
                <div class="inventory-container">
                    <h3 class="panel-title">å‚¨ç‰©è¢‹</h3>
                    <div id="items-grid" class="scrollable-content"></div>
                </div>
                <div class="achievement-container">
                    <h3 class="panel-title">æˆå°±</h3>
                    <div id="achievement-list" class="scrollable-content"></div>
                </div>
                 <div class="adventure-log-container">
                    <h3 class="panel-title">å†’é™©æ—¥å¿—</h3>
                    <div id="adventure-log" class="scrollable-content"></div>
                </div>
            </div>
        </div>

        <div class="api-settings-container">
            <h3 class="panel-title">API è®¾ç½®</h3>
            <div class="api-settings">
                <input type="text" id="api-url-input" placeholder="API URL (ä¾‹å¦‚: https://.../v1)">
                <select id="model-input" class="api-settings-select"></select>
                <input type="password" id="api-key-input" placeholder="API Key">
                <button id="save-api-btn">ä¿å­˜</button>
                <button id="clear-api-btn">æ¸…é™¤</button>
            </div>
        </div>

        <footer>
            ç”± AI é©±åŠ¨çš„æ–‡å­—å†’é™©æ¸¸æˆ
        </footer>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        const gameState = {
            faction: null,
            health: 100,
            maxHealth: 100,
            attack: 5,
            defense: 5,
            agility: 5,
            charm: 5,
            coins: 50,
            reputation: 0,
            level: 1, // è¿™é‡Œ level å¯ä»¥ä»£è¡¨å¢ƒç•Œç­‰çº§ï¼Œä¾‹å¦‚ 1-10 æ˜¯ç»ƒæ°”ï¼Œ11-20 æ˜¯ç­‘åŸº
            skills: [],
            items: [],
            achievements: [
                // åŸºç¡€æˆå°±
                { id: 'first_choice', text: 'é“å§‹äºè¶³ä¸‹: åšå‡ºä½ çš„ç¬¬ä¸€ä¸ªé€‰æ‹©', unlocked: false },
                { id: 'first_battle', text: 'åˆè¯•é”‹èŠ’: ç¬¬ä¸€æ¬¡ç»å†æˆ˜æ–—', unlocked: false },
                { id: 'first_victory', text: 'é¦–æˆ˜å‘Šæ·: èµ¢å¾—ç¬¬ä¸€åœºæˆ˜æ–—', unlocked: false },
                { id: 'breakthrough_qi', text: 'çªç ´ç»ƒæ°”: æˆåŠŸçªç ´åˆ°ç»ƒæ°”æœŸ', unlocked: false },
                { id: 'breakthrough_foundation', text: 'ç­‘åŸºä¹‹å§‹: æˆåŠŸç­‘åŸº', unlocked: false },

                // æ¢ç´¢ä¸å‘ç°
                { id: 'found_hidden_cave', text: 'æ´å¤©ç¦åœ°: å‘ç°ä¸€ä¸ªéšè—çš„æ´åºœ', unlocked: false },
                { id: 'found_ancient_ruin', text: 'ä¸Šå¤é—è¿¹: æ‰¾åˆ°ä¸€å¤„å¤ä»£ä¿®å£«çš„é—è¿¹', unlocked: false },
                { id: 'met_mysterious_master', text: 'é«˜äººæç‚¹: é‡åˆ°ä¸€ä½ç¥ç§˜çš„å‰è¾ˆ', unlocked: false },
                { id: 'survive_miasma_swamp', text: 'ç©¿è¶Šæ¯’ç˜´: æˆåŠŸç©¿è¶Šè‡´å‘½çš„ç˜´æ°”æ²¼æ³½', unlocked: false },

                // ç‰©å“ä¸è´¢å¯Œ
                { id: 'first_spirit_treasure', text: 'å¾—è·æ³•å®: è·å¾—ä½ çš„ç¬¬ä¸€ä»¶æ³•å®', unlocked: false },
                { id: 'rich_man', text: 'è…°ç¼ ä¸‡è´¯: æ‹¥æœ‰è¶…è¿‡10000çµçŸ³', unlocked: false },
                { id: 'master_alchemist', text: 'ç‚¼ä¸¹å¤§å¸ˆ: æˆåŠŸç‚¼åˆ¶ä¸€æšæå“ä¸¹è¯', unlocked: false },
                { id: 'spirit_stone_collector', text: 'çµçŸ¿æ”¶è—å®¶: é›†é½ä¸‰ç§ä¸åŒçš„ç¨€æœ‰çµçŸ¿', unlocked: false },

                // æˆ˜æ–—ä¸æŠ€å·§
                { id: 'flawless_victory', text: 'æ— ä¼¤èƒœåˆ©: åœ¨ä¸æŸå¤±ç”Ÿå‘½å€¼çš„æƒ…å†µä¸‹èµ¢å¾—ä¸€åœºæˆ˜æ–—', unlocked: false },
                { id: 'slay_demon_beast', text: 'æ–©å¦–é™¤é­”: å‡»è´¥ä¸€å¤´å¼ºå¤§çš„å¦–å…½', unlocked: false },
                { id: 'master_of_spells', text: 'ç¥é€šè‡ªæˆ: é¢†æ‚Ÿä¸€é¡¹å¼ºå¤§çš„ç¥é€š', unlocked: false },
                { id: 'survived_ambush', text: 'æ­»é‡Œé€ƒç”Ÿ: åœ¨ä¸€æ¬¡ä¿®å£«çš„æˆªæ€ä¸­å¹¸å­˜ä¸‹æ¥', unlocked: false },

                // ç¤¾äº¤ä¸å£°æœ›
                { id: 'high_reputation', text: 'å£°åæ˜¾èµ«: åœ¨ä¸€æ–¹åœ°åŸŸå£°æœ›è¾¾åˆ°é¡¶ç‚¹', unlocked: false },
                { id: 'sect_elder', text: 'å®—é—¨é•¿è€: æˆä¸ºä¸€ä¸ªå®—é—¨çš„é•¿è€', unlocked: false },
                { id: 'dao_companion', text: 'è§…å¾—é“ä¾£: ä¸å¦ä¸€ä½ä¿®å£«ç»“ä¸ºé“ä¾£', unlocked: false },
                { id: 'peacemaker', text: 'åŒ–è§£æ©ä»‡: æˆåŠŸè°ƒè§£ä¸¤ä¸ªæ•Œå¯¹åŠ¿åŠ›çš„çŸ›ç›¾', unlocked: false },

                // ç‰¹æ®Šä¸éšè—
                { id: 'defy_heavenly_tribulation', text: 'é€†å¤©æ¸¡åŠ«: ä»ä¸€æ¬¡ä¹æ­»ä¸€ç”Ÿçš„å¤©åŠ«ä¸­æ´»äº†ä¸‹æ¥', unlocked: false },
                { id: 'ancient_bloodline', text: 'è¡€è„‰è§‰é†’: è§‰é†’äº†ä½“å†…æ½œè—çš„ä¸Šå¤è¡€è„‰', unlocked: false },
                { id: 'uncovered_conspiracy', text: 'é˜´è°‹æ­éœ²è€…: å‘ç°å¹¶æ­éœ²äº†ä¸€ä¸ªå¨èƒæ•´ä¸ªå¤§é™†çš„é˜´è°‹', unlocked: false }
            ],
            adventureLog: [],
            turn: 0,
            currentScene: "start"
        };

        // DOMå…ƒç´ 
        const storyText = document.getElementById('story-text');
        const choicesContainer = document.getElementById('choices-container');
        const sceneImg = document.getElementById('scene-img');
        const loadingOverlay = document.getElementById('loading');
        const charName = document.getElementById('char-name');
        const healthBar = document.getElementById('health-bar');
        const healthText = document.getElementById('health-text');
        const skillsList = document.getElementById('skills-list');
        const apiUrlInput = document.getElementById('api-url-input');
        const modelInput = document.getElementById('model-input');
        const apiKeyInput = document.getElementById('api-key-input');
        const saveApiBtn = document.getElementById('save-api-btn');
        const clearApiBtn = document.getElementById('clear-api-btn');
        const coinsEl = document.querySelector('.status-bar .status-item:nth-child(1) .status-value');
        const reputationEl = document.querySelector('.status-bar .status-item:nth-child(2) .status-value');
        const levelEl = document.querySelector('.status-bar .status-item:nth-child(3) .status-value');
        const attackEl = document.getElementById('attack-value');
        const defenseEl = document.getElementById('defense-value');
        const agilityEl = document.getElementById('agility-value');
        const charmEl = document.getElementById('charm-value');
        const itemsGrid = document.getElementById('items-grid');
        const achievementList = document.getElementById('achievement-list');
        const adventureLogEl = document.getElementById('adventure-log');

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async () => {
            apiUrlInput.value = localStorage.getItem('customApiUrl') || '';
            apiKeyInput.value = localStorage.getItem('customApiKey') || '';
            
            await fetchModels();
            
            choicesContainer.addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON' || e.target.closest('button')) {
                    const button = e.target.closest('button');
                    handleChoice(button.dataset.choice, button.textContent.trim());
                }
            });

            saveApiBtn.addEventListener('click', saveApiSettings);
            clearApiBtn.addEventListener('click', clearApiSettings);
            
            showLoading(true); // åœ¨åˆå§‹åŠ è½½æ—¶æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
            const initialImagePrompt = "A vast and mystical Chinese cultivation world, with towering mountains shrouded in mist, a majestic sword sect, a dark shadowy demonic sect, and a tranquil alchemist's pavilion, ink wash painting style";
            generateImage(initialImagePrompt);
            updateUI();
        });

        // åŠ è½½åœºæ™¯ - ç°åœ¨å®Œå…¨ç”±AIé©±åŠ¨
        async function loadScene(sceneKey, playerChoiceText = null) {
            showLoading(true);
            
            try {
                const scene = await generateAdventure(sceneKey, playerChoiceText);
                if (!scene) {
                    alert('é”™è¯¯ï¼šAIæœªèƒ½ç”Ÿæˆæœ‰æ•ˆåœºæ™¯ã€‚');
                    showLoading(false);
                    return;
                }
                gameState.currentScene = sceneKey;
                storyText.textContent = scene.text;
                renderChoices(scene.choices);
                generateImage(scene.imagePrompt);
            } catch (error) {
                console.error("å†’é™©ç”Ÿæˆå¤±è´¥çš„è¯¦ç»†é”™è¯¯:", error);
                let errorMessage = error instanceof Error ? error.message : JSON.stringify(error);
                alert(`å†’é™©ç”Ÿæˆå¤±è´¥: ${errorMessage}\nè¯·æ£€æŸ¥APIè®¾ç½®æˆ–ç½‘ç»œè¿æ¥ï¼Œå¹¶æŸ¥çœ‹æ§åˆ¶å°è·å–è¯¦ç»†ä¿¡æ¯ã€‚\næ¸¸æˆå°†æš‚åœã€‚`);
                showLoading(false);
            }
        }

        // ä½¿ç”¨APIç”Ÿæˆå†’é™©
        async function generateAdventure(currentSceneKey, playerChoiceText) {
            let apiUrl = localStorage.getItem('customApiUrl');
            let apiKey = localStorage.getItem('customApiKey');
            let model = localStorage.getItem('customModel');

            if (!apiUrl) {
                apiUrl = 'https://chatapi.akash.network/api/v1';
                apiKey = 'sk-SAHbo-76o1JIV2aYsZJHaQ';
                model = 'DeepSeek-R1-0528';
            } else if (!model) {
                model = 'DeepSeek-R1-0528';
            }
            
            const previousSceneText = storyText.textContent;
            
            const prompt = `
ä½ æ˜¯ä¸€ä½èµ„æ·±æ¸¸æˆç­–åˆ’å…¼é¡¶å°–ç½‘ç»œå°è¯´å®¶ï¼Œæ­£åœ¨ä¸ºä¸€ä¸ªå¼€æ”¾ä¸–ç•Œæ²™ç›’ä¿®ä»™æ¸¸æˆæ„å»ºåŠ¨æ€å‰§æƒ…ã€‚ä½ çš„ä»»åŠ¡æ˜¯æ ¹æ®ç©å®¶çš„å½“å‰çŠ¶æ€å’Œé€‰æ‹©ï¼Œç”Ÿæˆé€»è¾‘ä¸¥å¯†ã€å¯Œæœ‰æƒ³è±¡åŠ›ä¸”ç¬¦åˆä¿®ä»™ä¸–ç•Œè§‚çš„ä¸‹ä¸€æ­¥å‰§æƒ…ã€‚

**ä¸–ç•Œè§‚æ ¸å¿ƒè®¾å®š:**
- **å¢ƒç•Œä½“ç³»:** [å‡¡äºº -> ç»ƒæ°” -> ç­‘åŸº -> é‡‘ä¸¹ -> å…ƒå©´ -> åŒ–ç¥...]ï¼Œå¢ƒç•Œæ˜¯è¡¡é‡å®åŠ›çš„æ ¸å¿ƒæ ‡å‡†ï¼Œçªç ´éœ€è¦æœºç¼˜å’Œç§¯ç´¯ã€‚
- **çµæ ¹èµ„è´¨:** ç©å®¶æ‹¥æœ‰éšè—çš„çµæ ¹å±æ€§ï¼ˆå¦‚é‡‘ã€æœ¨ã€æ°´ã€ç«ã€åœŸã€å†°ã€é›·ã€å˜å¼‚ç­‰ï¼‰ï¼Œå¯èƒ½ä¼šåœ¨ç‰¹å®šäº‹ä»¶ä¸­è¢«å‘ç°æˆ–è§‰é†’ï¼Œå½±å“åŠŸæ³•ä¿®ç‚¼é€Ÿåº¦å’Œå¨åŠ›ã€‚
- **èµ„æºä¸è´§å¸:** ä¸»è¦è´§å¸æ˜¯â€œçµçŸ³â€ã€‚ä¸¹è¯ã€æ³•å®ã€åŠŸæ³•ã€ç¬¦ç®“ã€é˜µç›˜ç­‰æ˜¯é‡è¦èµ„æºï¼Œå‡æœ‰å“é˜¶ä¹‹åˆ†ï¼ˆå¦‚ï¼šåŠ£å“ã€å‡¡å“ã€ç²¾å“ã€æå“ã€çµå“ã€ä»™å“ï¼‰ã€‚
- **å±æœºå››ä¼:** ä¿®ç‚¼ä¹‹è·¯å……æ»¡è‰°é™©ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºâ€œå¢ƒç•Œç“¶é¢ˆâ€ã€â€œå¿ƒé­”å…¥ä¾µâ€ã€â€œå¤ºå®ä»‡æ€â€ã€â€œå¦–å…½è‚†è™â€ã€â€œå®—é—¨æš—æ–—â€ã€â€œå¤©åŠ«è€ƒéªŒâ€ã€‚
- **é“å¿ƒä¸é˜µè¥:** ç©å®¶çš„é€‰æ‹©å°†å¡‘é€ å…¶â€œé“å¿ƒâ€ï¼Œå¹¶å¯èƒ½åœ¨ä¸ç»æ„é—´ä¸å„å¤§åŠ¿åŠ›ï¼ˆå¦‚ï¼šåé—¨æ­£æ´¾ã€ä¸Šå¤å®—é—¨ã€åƒå¹´ä¸–å®¶ã€é‚ªé­”å¤–é“ã€æ•£ä¿®è”ç›Ÿï¼‰äº§ç”Ÿè”ç³»ï¼Œå½±å“å£°æœ›å’Œå…³ç³»ã€‚

**åˆ›ä½œä¸å™äº‹æŒ‡å—:**
1.  **é£æ ¼:** ä¿æŒå¤å…¸ä»™ä¾ æ–‡é£ï¼Œæ–‡å­—ç²¾ç‚¼ï¼Œæ„å¢ƒæ‚ è¿œã€‚ä¾‹ï¼šâ€œè¡Œè‡³å±±ç©·æ°´å°½å¤„ï¼Œå¿½é—»é¹¤é¸£äºä¹å¤©ä¹‹ä¸Šï¼Œé¥è§é£ç€‘æŒ‚äºç¿ å£ä¹‹é—´ï¼Œç–‘æ˜¯ä»™äººæ´åºœç°ä¸–ã€‚â€
2.  **å¥‡é‡ä¸é€»è¾‘:** å‰§æƒ…éœ€ç¬¦åˆé€»è¾‘ï¼Œä½†è¦å……æ»¡â€œå¥‡é‡æ„Ÿâ€ã€‚åˆ›é€ ç»å…¸ä¿®ä»™æ¡¥æ®µï¼Œå¦‚â€œå å´–ä¸æ­»è·ä¼ æ‰¿â€ã€â€œåŠå¸‚æ·˜å®æ¡åˆ°æ¼â€ã€â€œè¯¯å…¥ä¸Šå¤ä¿®å£«æ´åºœâ€ã€â€œè¢«å·å…¥æ­£é­”ä¸¤é“çº·äº‰â€ç­‰ï¼Œå¹¶è®©è¿™äº›äº‹ä»¶å¯¹ç©å®¶äº§ç”Ÿé•¿è¿œå½±å“ã€‚
3.  **NPCäº’åŠ¨:** è®¾è®¡æœ‰è¡€æœ‰è‚‰çš„NPCï¼Œä»–ä»¬æœ‰è‡ªå·±çš„èƒŒæ™¯å’ŒåŠ¨æœºï¼Œä¸ç©å®¶çš„äº’åŠ¨å¯èƒ½è§¦å‘éšè—ä»»åŠ¡ã€ç»“ä¸ºé“ä¾£æˆ–æ­»æ•Œã€‚
4.  **æˆ˜æ–—æå†™:** æˆ˜æ–—åº”ä½“ç°ä¿®ä»™ç‰¹è‰²ï¼Œå¦‚â€œé£å‰‘ä¸æ³•å®çš„ç¢°æ’â€ã€â€œç¥è¯†çš„äº¤é”‹â€ã€â€œç¬¦ç®“ä¸é˜µæ³•çš„è¿ç”¨â€ã€‚æˆ˜æ–—ç»“æœéœ€é€šè¿‡'gameStateUpdates'æ˜ç¡®åé¦ˆæ•°å€¼å˜åŒ–ã€‚
5.  **æœ‰æ„ä¹‰çš„é€‰æ‹©:**
    - æä¾›3-4ä¸ªç¬¦åˆå½“å‰æƒ…æ™¯ã€çœŸæ­£å½±å“åç»­å‘å±•çš„é€‰æ‹©ã€‚
    - é€‰é¡¹åº”èƒ½ä½“ç°ä¸åŒçš„æ€§æ ¼å’Œç­–ç•¥ï¼ˆå¦‚ï¼šæ€äººå¤ºå®ã€è°¨æ…æ¢ç´¢ã€ç»“äº¤ç›Ÿå‹ã€æš‚é¿é”‹èŠ’ï¼‰ã€‚
    - é¿å…ç®€å•çš„é‡å¤ï¼Œè®©ç©å®¶æ„Ÿå—åˆ°é€‰æ‹©çš„é‡é‡ã€‚
    - åœ¨åˆé€‚çš„æ—¶å€™ï¼Œæä¾›è¿”å›å®‰å…¨åŒºï¼ˆå¦‚æ´åºœã€åŠå¸‚ï¼‰çš„é€‰é¡¹ï¼Œtargetåº”è®¾ä¸º 'safe_zone'ã€‚

**ä¸¥æ ¼éµå®ˆçš„JSONè¾“å‡ºæ ¼å¼:**
{
  "text": "string (å¼•äººå…¥èƒœã€å……æ»¡ä»™ä¾ æ„å¢ƒçš„åœºæ™¯/äº‹ä»¶æè¿°)",
  "imagePrompt": "string (ç”¨äºAIç»˜ç”»çš„è‹±æ–‡æç¤ºè¯ï¼Œé£æ ¼: 'Chinese ink wash painting, mystical, ancient cultivation world, ...')",
  "choices": [
    { "text": "string (ç»™ç©å®¶çš„é€‰æ‹©1)", "target": "string (ä»£è¡¨é€‰æ‹©1çš„å‰§æƒ…åˆ†æ”¯æ ‡è¯†)" },
    { "text": "string (ç»™ç©å®¶çš„é€‰æ‹©2)", "target": "string (ä»£è¡¨é€‰æ‹©2çš„å‰§æƒ…åˆ†æ”¯æ ‡è¯†)" }
  ],
  "gameStateUpdates": {
    "health": "number (ç”Ÿå‘½å€¼çš„å¢é‡, å¯ä¸ºè´Ÿ)",
    "coins": "number (çµçŸ³çš„å¢é‡)",
    "attack": "number (æ”»å‡»åŠ›çš„å¢é‡)",
    "reputation": "number (å£°æœ›çš„å¢é‡)"
  },
  "itemUpdates": { "add": ["string (è·å¾—çš„ç‰©å“å)"], "remove": ["string (å¤±å»çš„ç‰©å“å)"] },
  "unlockAchievements": ["string (éœ€è¦è§£é”çš„æˆå°±ID)"],
  "logEntry": "string (å¯¹æœ¬æ¬¡äº‹ä»¶çš„ç®€çŸ­æ€»ç»“ï¼Œè®°å…¥å†’é™©æ—¥å¿—)"
}

**å½“å‰æƒ…å¢ƒ:**
- **ç©å®¶çŠ¶æ€:** ${JSON.stringify(gameState)}
- **ä¸Šä¸€å¹•å‰§æƒ…:** "${previousSceneText}"
- **ç©å®¶åˆšåˆšçš„é€‰æ‹©:** "${playerChoiceText}"

è¯·åŸºäºä»¥ä¸Šæ‰€æœ‰ä¿¡æ¯ï¼Œç”Ÿæˆä¸‹ä¸€å¹•çš„å‰§æƒ…ã€‚
`;

            const finalApiUrl = apiUrl.trim() + '/chat/completions';

            const response = await fetch(finalApiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${apiKey}` },
                body: JSON.stringify({
                    model: model,
                    messages: [{ role: 'user', content: prompt }],
                    response_format: { type: "json_object" }
                })
            });

            if (!response.ok) {
                throw new Error(`API è¯·æ±‚å¤±è´¥: ${response.status} ${await response.text()}`);
            }

            const data = await response.json();
            let contentString = data.choices[0].message.content;
            const match = contentString.match(/```json\s*([\s\S]*?)\s*```/);
            if (match) contentString = match[1];

            try {
                const content = JSON.parse(contentString);
                console.log("ä»AIæ”¶åˆ°çš„åŸå§‹content:", JSON.stringify(content, null, 2));

                if (content.gameStateUpdates) {
                    const updates = content.gameStateUpdates;
                    ['health', 'maxHealth', 'attack', 'defense', 'agility', 'charm', 'coins', 'reputation', 'level'].forEach(key => {
                        if (updates[key] !== undefined && typeof gameState[key] === 'number') {
                            gameState[key] += updates[key];
                        }
                    });
                    if (gameState.health < 0) gameState.health = 0;
                    if (gameState.health > gameState.maxHealth) gameState.health = gameState.maxHealth;
                    
                    if (updates.skills && Array.isArray(updates.skills)) {
                        updates.skills.forEach(skillName => {
                            if (!gameState.skills.find(s => s.name === skillName)) {
                                gameState.skills.push({
                                    name: skillName,
                                    description: "ä¸€ä¸ªåœ¨å†’é™©ä¸­ä¹ å¾—çš„ç¥ç§˜æŠ€èƒ½ã€‚",
                                    icon: "fa-solid fa-star"
                                });
                            }
                        });
                    }
                }

                if (content.itemUpdates) {
                    if (content.itemUpdates.add && Array.isArray(content.itemUpdates.add)) {
                        content.itemUpdates.add.forEach(newItemName => {
                            if (typeof newItemName === 'string') {
                                gameState.items.push({ id: newItemName.toLowerCase().replace(/\s/g, '_'), name: newItemName });
                            }
                        });
                    }
                    if (content.itemUpdates.remove) {
                        content.itemUpdates.remove.forEach(itemIdToRemove => {
                            gameState.items = gameState.items.filter(item => item.id !== itemIdToRemove);
                        });
                    }
                }

                if (content.unlockAchievements && Array.isArray(content.unlockAchievements)) {
                    content.unlockAchievements.forEach(achIdToUnlock => {
                        const achievement = gameState.achievements.find(a => a.id === achIdToUnlock);
                        if (achievement && !achievement.unlocked) {
                            achievement.unlocked = true;
                        }
                    });
                }
                
                if(content.logEntry && typeof content.logEntry === 'string') {
                    gameState.turn++;
                    gameState.adventureLog.push({ turn: gameState.turn, entry: content.logEntry });
                }

                updateUI();
                return content;
            } catch (e) {
                console.error("åœ¨ generateAdventure å†…éƒ¨å¤„ç†æ—¶å‘ç”Ÿä¸¥é‡é”™è¯¯:", e);
                console.error("å‘ç”Ÿé”™è¯¯æ—¶çš„ gameState:", JSON.stringify(gameState, null, 2));
                throw new Error(`å¤„ç†AIå“åº”æ—¶å‡ºé”™: ${e.message}`);
            }
        }

        function generateImage(prompt) {
             const url = `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?nologo=true`;
             const img = new Image();
             sceneImg.style.opacity = 0.5;
             img.onload = () => { sceneImg.src = url; sceneImg.style.opacity = 1; showLoading(false); };
             img.onerror = () => { console.error("å›¾ç‰‡åŠ è½½å¤±è´¥"); showLoading(false); };
             img.src = url;
        }
        
        function renderChoices(choices) {
            choicesContainer.innerHTML = '';
            if (!choices || choices.length === 0) {
                const endButton = document.createElement('button');
                endButton.className = 'choice-btn';
                endButton.textContent = 'æœ¬æ¬¡å†’é™©æš‚å‘Šä¸€æ®µè½ï¼Œåˆ·æ–°é¡µé¢é‡æ–°å¼€å§‹ã€‚';
                endButton.onclick = () => window.location.reload();
                choicesContainer.appendChild(endButton);
                return;
            }
            choices.forEach(choice => {
                const button = document.createElement('button');
                button.className = 'choice-btn';
                button.dataset.choice = choice.target;
                button.textContent = choice.text;
                choicesContainer.appendChild(button);
            });
        }
        
        function handleChoice(choiceTarget, choiceText) {
            const firstChoiceAch = gameState.achievements.find(a => a.id === 'first_choice');
            if (firstChoiceAch && !firstChoiceAch.unlocked) {
                firstChoiceAch.unlocked = true;
            }
            loadScene(choiceTarget, choiceText);
        }

        function showLoading(show) {
            loadingOverlay.classList.toggle('active', show);
        }

        function updateUI() {
            if (!Array.isArray(gameState.adventureLog)) {
                gameState.adventureLog = [];
            }

            healthBar.style.width = `${(gameState.health / gameState.maxHealth) * 100}%`;
            healthText.textContent = `HP: ${gameState.health}/${gameState.maxHealth}`;
            coinsEl.textContent = gameState.coins;
            reputationEl.textContent = gameState.reputation;
            
            // æ›´æ–°å¢ƒç•Œæ˜¾ç¤º
            if (gameState.level > 20) {
                levelEl.textContent = 'é‡‘ä¸¹';
            } else if (gameState.level > 10) {
                levelEl.textContent = 'ç­‘åŸº';
            } else if (gameState.level > 1) {
                 levelEl.textContent = 'ç»ƒæ°”';
            } else {
                levelEl.textContent = 'å‡¡äºº';
            }
            levelEl.title = `ç­‰çº§: ${gameState.level}`;


            attackEl.textContent = gameState.attack;
            defenseEl.textContent = gameState.defense;
            agilityEl.textContent = gameState.agility;
            charmEl.textContent = gameState.charm;

            skillsList.innerHTML = '';
            if (!gameState.skills || gameState.skills.length === 0) {
                skillsList.innerHTML = '<div>å°šæœªå­¦ä¹ ä»»ä½•åŠŸæ³•</div>';
            } else {
                gameState.skills.forEach(skill => {
                    const skillItem = document.createElement('div');
                    skillItem.className = 'skill-item';
                    skillItem.innerHTML = `<div class="skill-name"><i class="${skill.icon || 'fa-solid fa-star'}"></i> ${skill.name}</div><div>${skill.description}</div>`;
                    skillsList.appendChild(skillItem);
                });
            }
            
            itemsGrid.innerHTML = '';
            if (!gameState.items || gameState.items.length === 0) {
                itemsGrid.innerHTML = '<div>ç©ºç©ºå¦‚ä¹Ÿ...</div>';
            } else {
                gameState.items.forEach(item => {
                    const itemEl = document.createElement('div');
                    itemEl.className = 'item-text';
                    itemEl.textContent = `â€¢ ${item.name}`;
                    itemsGrid.appendChild(itemEl);
                });
            }

            achievementList.innerHTML = '';
            const unlockedAchievements = gameState.achievements.filter(a => a.unlocked);
            if (unlockedAchievements.length === 0) {
                achievementList.innerHTML = '<div>å°šæœªè§£é”</div>';
            } else {
                unlockedAchievements.forEach(ach => {
                    const achEl = document.createElement('div');
                    achEl.className = 'achievement-text';
                    achEl.textContent = `â€¢ ${ach.text}`;
                    achievementList.appendChild(achEl);
                });
            }
            
            adventureLogEl.innerHTML = '';
            if (!gameState.adventureLog || gameState.adventureLog.length === 0) {
                adventureLogEl.innerHTML = '<div>å†’é™©å°šæœªå¼€å§‹...</div>';
            } else {
                gameState.adventureLog.slice().reverse().forEach(log => {
                    const logEl = document.createElement('div');
                    logEl.className = 'log-entry';
                    logEl.innerHTML = `<span class="log-turn">[å›åˆ ${log.turn}]</span> ${log.entry}`;
                    adventureLogEl.appendChild(logEl);
                });
            }
        }
        
        async function fetchModels() {
            const modelSelect = document.getElementById('model-input');
            modelSelect.innerHTML = '<option value="">åŠ è½½ä¸­...</option>';
            
            try {
                let apiUrl = apiUrlInput.value.trim() || 'https://chatapi.akash.network/api/v1';
                let apiKey = apiKeyInput.value.trim() || 'sk-SAHbo-76o1JIV2aYsZJHaQ';

                if (apiUrl.endsWith('/')) apiUrl = apiUrl.slice(0, -1);
                const modelsUrl = `${apiUrl}/models`;

                const response = await fetch(modelsUrl, {
                    headers: {
                        'Authorization': `Bearer ${apiKey}`
                    }
                });

                if (!response.ok) {
                    throw new Error(`è·å–æ¨¡å‹åˆ—è¡¨å¤±è´¥: ${response.status}`);
                }

                const data = await response.json();
                const models = data.data
                    .filter(model => model.id)
                    .sort((a, b) => a.id.localeCompare(b.id));

                modelSelect.innerHTML = models
                    .map(model => `<option value="${model.id}">${model.id}</option>`)
                    .join('');
                
                const savedModel = localStorage.getItem('customModel');
                if (savedModel && models.some(m => m.id === savedModel)) {
                    modelSelect.value = savedModel;
                }
            } catch (error) {
                console.error('è·å–æ¨¡å‹åˆ—è¡¨å¤±è´¥:', error);
                modelSelect.innerHTML = '<option value="DeepSeek-R1-0528">DeepSeek-R1-0528</option>';
            }
        }

        function saveApiSettings() {
            localStorage.setItem('customApiUrl', apiUrlInput.value);
            localStorage.setItem('customModel', modelInput.value);
            localStorage.setItem('customApiKey', apiKeyInput.value);
            fetchModels();
            alert('APIè®¾ç½®å·²ä¿å­˜!');
        }

        function clearApiSettings() {
            localStorage.removeItem('customApiUrl');
            localStorage.removeItem('customModel');
            localStorage.removeItem('customApiKey');
            apiUrlInput.value = '';
            modelInput.value = '';
            apiKeyInput.value = '';
            alert('APIè®¾ç½®å·²æ¸…é™¤!');
        }
    </script>
</body>
</html>