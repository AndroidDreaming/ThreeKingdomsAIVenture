<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9067024774549867"
     crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ã€Šä¸‰å›½å¿—ï¼šä¹±ä¸–äº‰é›„ã€‹æ˜¯ä¸€ä¸ªç”±AIé©±åŠ¨çš„æ–‡å­—ç­–ç•¥æ¸¸æˆã€‚åœ¨è¿™é‡Œï¼Œä½ å°†ç½®èº«äºæ³¢æ¾œå£®é˜”çš„ä¸‰å›½æ—¶ä»£ï¼Œä»ä¸€ä»‹å¸ƒè¡£åˆ°ç§°éœ¸ä¸€æ–¹ï¼Œæ‹›å‹Ÿå°†é¢†ï¼Œå‘å±•åŸæ± ï¼Œä¹¦å†™ä½ çš„éœ¸ä¸šä¼ å¥‡ã€‚">
    <meta name="keywords" content="ä¸‰å›½, æ–‡å­—æ¸¸æˆ, ç­–ç•¥, AI, æ²™ç›’, è§’è‰²æ‰®æ¼”, RPG, äº’åŠ¨å°è¯´, ä¹±ä¸–">
    <meta name="author" content="AIæ²™ç›’ä¸–ç•Œ">

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://your-game-url.com/"> <meta property="og:title" content="ä¸‰å›½å¿—ï¼šä¹±ä¸–äº‰é›„ - AIé©±åŠ¨çš„æ²™ç›’ç­–ç•¥æ¸¸æˆ">
    <meta property="og:description" content="ç©¿è¶Šè‡³ä¸‰å›½ä¹±ä¸–ï¼Œæ‹›å‹Ÿç¾¤é›„ï¼Œå‘å±•åŠ¿åŠ›ï¼Œä»¥æ™ºè°‹ä¸æ­¦åŠ›ç»Ÿä¸€å¤©ä¸‹ï¼Œä½ çš„æ¯ä¸€æ¬¡é€‰æ‹©éƒ½å°†å½±å“å†å²çš„èµ°å‘ã€‚">
    <meta property="og:image" content="https://your-game-url.com/preview-image-sanguo.jpg"> <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://your-game-url.com/"> <meta property="twitter:title" content="ä¸‰å›½å¿—ï¼šä¹±ä¸–äº‰é›„ - AIé©±åŠ¨çš„æ²™ç›’ç­–ç•¥æ¸¸æˆ">
    <meta property="twitter:description" content="ç©¿è¶Šè‡³ä¸‰å›½ä¹±ä¸–ï¼Œæ‹›å‹Ÿç¾¤é›„ï¼Œå‘å±•åŠ¿åŠ›ï¼Œä»¥æ™ºè°‹ä¸æ­¦åŠ›ç»Ÿä¸€å¤©ä¸‹ï¼Œä½ çš„æ¯ä¸€æ¬¡é€‰æ‹©éƒ½å°†å½±å“å†å²çš„èµ°å‘ã€‚">
    <meta property="twitter:image" content="https://your-game-url.com/preview-image-sanguo.jpg"> <title>ä¸‰å›½å¿—ï¼šä¹±ä¸–äº‰é›„ - AIæ²™ç›’ä¸–ç•Œ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2jrdWGYoSBM/Qj+a6PzAUu5+K4vQzJ/pL4mWQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* å¼•å…¥ä¸­æ–‡å­—ä½“ */
        @font-face {
            font-family: 'LongCang';
            src: url('https://fonts.gstatic.com/s/longcang/v19/HhyaU5mfoSi_gW-t7QgtC0c.woff2') format('woff2');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }

        @font-face {
            font-family: 'ZhiMangXing';
            src: url('https://fonts.gstatic.com/s/zhimangxing/v19/uU9ez_h2rlXoYfK_cM_hzM_x0YfL-z0.woff2') format('woff2');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }

        /* å…¨å±€æ ·å¼ */
        body {
            font-family: 'LongCang', cursive, sans-serif; /* ä¸»è¦æ–‡å­—ä½¿ç”¨æ­¤å­—ä½“ */
            margin: 0;
            padding: 0;
            background: linear-gradient(to bottom right, #2a2a2a, #000); /* æ·±è‰²æ¸å˜èƒŒæ™¯ */
            color: #e0e0e0; /* é»˜è®¤æ–‡å­—é¢œè‰² */
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* æ ‡é¢˜éƒ¨åˆ† */
        header {
            text-align: center;
            padding: 25px 20px;
            background-color: #1a1a1a;
            border-bottom: 2px solid #444; /* æ›´æ˜æ˜¾çš„åˆ†å‰²çº¿ */
            box-shadow: 0 4px 8px rgba(0,0,0,0.5); /* å¢åŠ é˜´å½± */
        }

        header h1 {
            font-family: 'ZhiMangXing', cursive, sans-serif; /* æ ‡é¢˜ä½¿ç”¨æ­¤å­—ä½“ */
            color: #ffd700; /* é†’ç›®çš„é‡‘è‰² */
            margin-bottom: 8px;
            font-size: 3.2em; /* å¢å¤§æ ‡é¢˜ */
            text-shadow: 3px 3px 6px rgba(0,0,0,0.9); /* æ›´æ·±æ²‰çš„é˜´å½± */
            letter-spacing: 2px; /* å¢åŠ å­—é—´è· */
        }

        header .subtitle {
            color: #b0b0b0;
            font-size: 1.2em;
            margin-top: 5px;
        }

        /* ä¸»è¦å†…å®¹åŒºåŸŸ */
        .main-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 25px; /* å¢åŠ ç»„ä»¶é—´è· */
            padding: 25px;
            flex-grow: 1;
            box-sizing: border-box;
        }

        /* æ¸¸æˆä¸»åŒºåŸŸ */
        .game-area {
            flex: 2 1 650px; /* è°ƒæ•´å®½åº¦å æ¯” */
            background-color: #1c1c1c; /* ç•¥æµ…äºèƒŒæ™¯çš„æ·±è‰² */
            border: 1px solid #3a3a3a;
            border-radius: 12px; /* æ›´åœ†æ¶¦çš„è¾¹è§’ */
            padding: 25px;
            box-shadow: 0 0 20px rgba(0,0,0,0.8); /* æ›´æ˜æ˜¾çš„é˜´å½± */
            display: flex;
            flex-direction: column;
            min-height: 550px; /* æœ€å°é«˜åº¦ */
        }

        /* åœºæ™¯å›¾ç‰‡å®¹å™¨ */
        .image-container {
            text-align: center;
            margin-bottom: 25px;
            min-height: 220px;
            background-color: #1a1a1a;
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #333; /* å›¾ç‰‡æ¡†è¾¹æ¡† */
        }

        .game-image {
            max-width: 100%;
            max-height: 450px; /* é™åˆ¶å›¾ç‰‡é«˜åº¦ */
            height: auto;
            border-radius: 8px;
            display: block;
        }

        /* æ•…äº‹æ–‡æœ¬åŒºåŸŸ */
        .story-text {
            font-size: 1.3em; /* å¢å¤§å­—ä½“ */
            line-height: 1.8; /* å¢åŠ è¡Œé«˜ï¼Œæå‡é˜…è¯»èˆ’é€‚åº¦ */
            margin-bottom: 25px;
            background-color: #1a1a1a;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #333;
            flex-grow: 1;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #666 #2a2a2a; /* è‡ªå®šä¹‰æ»šåŠ¨æ¡é¢œè‰² */
            text-align: justify; /* ä¸¤ç«¯å¯¹é½ */
        }

        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
        .story-text::-webkit-scrollbar,
        .scrollable-content::-webkit-scrollbar {
            width: 10px;
        }

        .story-text::-webkit-scrollbar-track,
        .scrollable-content::-webkit-scrollbar-track {
            background: #2a2a2a;
            border-radius: 10px;
        }

        .story-text::-webkit-scrollbar-thumb,
        .scrollable-content::-webkit-scrollbar-thumb {
            background-color: #666; /* æ»šåŠ¨æ¡é¢œè‰² */
            border-radius: 10px;
            border: 2px solid #2a2a2a;
        }

        /* é€‰é¡¹æŒ‰é’®å®¹å™¨ */
        .choices-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); /* è°ƒæ•´æœ€å°å®½åº¦ */
            gap: 15px; /* å¢åŠ æŒ‰é’®é—´è· */
            margin-top: 25px;
        }

        /* é€‰é¡¹æŒ‰é’® */
        .choice-btn {
            background-color: #383838; /* æŒ‰é’®èƒŒæ™¯è‰² */
            color: #e0e0e0;
            border: 1px solid #555;
            padding: 15px 20px; /* å¢å¤§æŒ‰é’®å¡«å…… */
            border-radius: 8px; /* åœ†æ¶¦è¾¹è§’ */
            font-size: 1.2em; /* å¢å¤§å­—ä½“ */
            cursor: pointer;
            transition: background-color 0.3s, border-color 0.3s, transform 0.2s; /* å¢åŠ åŠ¨ç”»æ•ˆæœ */
            font-family: 'LongCang', cursive, sans-serif;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            box-shadow: 0 2px 5px rgba(0,0,0,0.4);
        }

        .choice-btn:hover {
            background-color: #4a4a4a;
            border-color: #777;
            transform: translateY(-2px); /* æ‚¬åœä¸Šæµ®æ•ˆæœ */
        }

        .choice-btn:active {
            background-color: #2a2a2a;
            border-color: #444;
            transform: translateY(0); /* ç‚¹å‡»ä¸‹æ²‰æ•ˆæœ */
        }

        /* ä¾§è¾¹æ  */
        .sidebar {
            flex: 1 1 350px; /* è°ƒæ•´å®½åº¦å æ¯” */
            background-color: #1c1c1c;
            border: 1px solid #3a3a3a;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 0 20px rgba(0,0,0,0.8);
            display: flex;
            flex-direction: column;
            gap: 25px; /* å¢åŠ é¢æ¿é—´è· */
        }

        /* ä¾§è¾¹æ é¢æ¿ */
        .panel {
            background-color: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 20px;
            box-sizing: border-box;
            box-shadow: inset 0 0 8px rgba(0,0,0,0.5); /* å†…éƒ¨é˜´å½± */
        }

        .panel-title {
            color: #ffd700;
            font-family: 'ZhiMangXing', cursive, sans-serif;
            font-size: 1.8em; /* å¢å¤§é¢æ¿æ ‡é¢˜ */
            margin-top: 0;
            margin-bottom: 15px;
            text-align: center;
            border-bottom: 2px solid #444; /* æ›´æ˜æ˜¾çš„æ ‡é¢˜ä¸‹åˆ’çº¿ */
            padding-bottom: 8px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.7);
        }

        /* é¡¶éƒ¨çŠ¶æ€æ  */
        .status-bar {
            display: flex;
            justify-content: space-around;
            background-color: #1a1a1a;
            border-top: 2px solid #444;
            padding: 15px 20px;
            text-align: center;
            box-shadow: 0 -4px 8px rgba(0,0,0,0.5); /* å¢åŠ é˜´å½± */
        }

        .status-item {
            flex: 1;
            padding: 0 15px;
            font-size: 1.2em; /* å¢å¤§å­—ä½“ */
            color: #bbb;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px; /* æ ‡ç­¾å’Œå€¼ä¹‹é—´çš„é—´è· */
        }

        .status-item span:first-child {
            font-size: 0.9em;
            color: #999;
        }

        .status-item .status-value {
            color: #eee;
            font-weight: bold;
            font-size: 1.1em; /* å¢å¤§æ•°å€¼å­—ä½“ */
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        /* è§’è‰²ä¿¡æ¯é¢æ¿ */
        .character-info .char-header {
            display: flex;
            align-items: center;
            gap: 15px; /* å¢åŠ å¤´åƒå’Œåç§°é—´è· */
            margin-bottom: 15px;
            justify-content: center; /* å±…ä¸­æ˜¾ç¤º */
        }

        .character-info .char-icon {
            font-size: 3em; /* å¢å¤§å›¾æ ‡ */
            color: #ffd700;
        }

        .character-info .char-name {
            font-size: 2.2em; /* å¢å¤§åç§°å­—ä½“ */
            font-family: 'ZhiMangXing', cursive, sans-serif;
            color: #eee;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.6);
        }

        .health-bar {
            width: 100%;
            height: 25px; /* å¢å¤§è¡€æ¡é«˜åº¦ */
            background-color: #555;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 15px;
            position: relative;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.5);
        }

        .health-fill {
            height: 100%;
            background-color: #dc3545; /* é²œè‰³çš„çº¢è‰² */
            width: 100%;
            border-radius: 12px;
            transition: width 0.5s ease-in-out;
        }

        .health-text {
            position: absolute;
            width: 100%;
            text-align: center;
            line-height: 25px;
            color: #fff;
            font-size: 1em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
            font-weight: bold;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px; /* å¢åŠ å±æ€§é—´è· */
        }

        .stat-item {
            background-color: #2a2a2a;
            padding: 10px 15px; /* å¢å¤§å¡«å…… */
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.15em;
            color: #c0c0c0;
            border: 1px solid #3d3d3d;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }

        .stat-item .stat-value {
            color: #ffd700; /* é‡‘è‰²æ•°å€¼ */
            font-weight: bold;
            font-size: 1.1em;
        }

        /* å¯æ»šåŠ¨å†…å®¹åŒºåŸŸï¼ˆæŠ€èƒ½ã€ç‰©å“ã€æˆå°±ã€æ—¥å¿—ï¼‰ */
        .scrollable-content {
            max-height: 180px; /* å¢å¤§é«˜åº¦ */
            overflow-y: auto;
            border: 1px solid #3a3a3a;
            border-radius: 6px;
            padding: 12px;
            background-color: #2a2a2a;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.5);
        }

        .skill-item, .item-text, .achievement-text, .adventure-log-entry {
            background-color: #333;
            padding: 10px; /* å¢å¤§å¡«å…… */
            border-radius: 5px;
            margin-bottom: 8px; /* å¢åŠ è¡Œé—´è· */
            font-size: 1em;
            color: #ccc;
            border-left: 3px solid #ffd700; /* å·¦ä¾§é‡‘æ¡ */
            transition: background-color 0.2s;
        }

        .skill-item:hover, .item-text:hover, .achievement-text:hover, .adventure-log-entry:hover {
            background-color: #3d3d3d;
        }

        .skill-item .skill-name {
            color: #ffd700;
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 1.1em;
        }

        .skill-item .skill-description {
            font-size: 0.9em;
            color: #bbb;
        }

        .item-text i, .skill-item i {
            margin-right: 8px;
            color: #ffd700;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85); /* æ›´æ·±çš„åŠé€æ˜èƒŒæ™¯ */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 1.8em; /* å¢å¤§å­—ä½“ */
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.4s ease-in-out;
            font-family: 'ZhiMangXing', cursive, sans-serif;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }

        .loading-overlay.visible {
            opacity: 1;
            pointer-events: all;
        }

        .loading-spinner {
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-top: 5px solid #ffd700; /* é‡‘è‰²æ—‹è½¬ */
            border-radius: 50%;
            width: 60px; /* å¢å¤§åŠ è½½åœˆ */
            height: 60px;
            animation: spin 1.2s linear infinite; /* ç¨å¾®æ…¢ä¸€ç‚¹ */
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* é¡µè„š */
        footer {
            text-align: center;
            padding: 20px;
            background-color: #1a1a1a;
            border-top: 2px solid #444;
            color: #888;
            font-size: 1em;
            margin-top: auto;
            box-shadow: 0 -4px 8px rgba(0,0,0,0.5);
        }

        /* å“åº”å¼å¸ƒå±€ */
        @media (max-width: 1200px) {
            .main-container {
                flex-direction: column;
                align-items: center;
                padding: 20px;
            }

            .game-area, .sidebar {
                flex: none;
                width: 90%;
                max-width: 800px;
                padding: 20px;
            }

            .story-text {
                font-size: 1.2em;
            }

            .choice-btn {
                font-size: 1.1em;
                padding: 12px 15px;
            }

            .header h1 {
                font-size: 2.8em;
            }
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 2.5em;
            }

            header .subtitle {
                font-size: 1em;
            }

            .status-bar {
                flex-wrap: wrap;
                padding: 10px;
            }

            .status-item {
                flex: 0 0 50%; /* æ¯è¡Œæ˜¾ç¤ºä¸¤ä¸ªçŠ¶æ€ */
                margin-bottom: 10px;
                font-size: 1em;
            }

            .game-area, .sidebar {
                width: 95%;
                padding: 15px;
                gap: 20px;
            }

            .story-text {
                font-size: 1.1em;
                padding: 15px;
            }

            .choices-container {
                grid-template-columns: 1fr; /* åœ¨å°å±å¹•ä¸Šå•åˆ—æ˜¾ç¤ºæŒ‰é’® */
                gap: 10px;
            }

            .choice-btn {
                font-size: 1em;
                padding: 10px 12px;
            }

            .panel-title {
                font-size: 1.6em;
            }

            .character-info .char-icon {
                font-size: 2.5em;
            }

            .character-info .char-name {
                font-size: 1.8em;
            }

            .health-bar {
                height: 20px;
            }

            .stats-grid {
                gap: 10px;
            }

            .stat-item {
                font-size: 1em;
                padding: 8px 10px;
            }
            .scrollable-content {
                max-height: 150px;
            }
            .loading-spinner {
                width: 40px;
                height: 40px;
            }
            .loading-overlay p {
                font-size: 1.3em;
            }
        }

        @media (max-width: 480px) {
            header {
                padding: 15px 10px;
            }
            header h1 {
                font-size: 2em;
            }
            .main-container {
                padding: 10px;
                gap: 15px;
            }
            .game-area, .sidebar {
                padding: 10px;
                gap: 15px;
            }
            .status-item {
                flex: 0 0 100%; /* åœ¨æ›´å°çš„å±å¹•ä¸Šæ¯è¡Œä¸€ä¸ªçŠ¶æ€ */
                font-size: 0.9em;
            }
            .story-text {
                font-size: 1em;
                padding: 10px;
            }
            .choice-btn {
                font-size: 0.9em;
                padding: 8px 10px;
            }
            .panel-title {
                font-size: 1.4em;
            }
            .character-info .char-name {
                font-size: 1.5em;
            }
            .stat-item {
                font-size: 0.9em;
            }
            .scrollable-content {
                max-height: 120px;
            }
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner"></div>
        <p id="loading-text">æ­£åœ¨åˆ†æä¹±ä¸–å±€åŠ¿...</p>
    </div>

    <header>
        <h1>ä¸‰å›½å¿—ï¼šä¹±ä¸–äº‰é›„</h1>
        <p class="subtitle">ä¸€ä¸ªç”±AIé©±åŠ¨çš„æ²™ç›’ç­–ç•¥æ¸¸æˆ</p>
    </header>

    <div class="status-bar">
        <div class="status-item"><span>é‡‘é’±</span><span class="status-value" id="coins-value">0</span></div>
        <div class="status-item"><span>å£°æœ›</span><span class="status-value" id="reputation-value">0</span></div>
        <div class="status-item"><span>å®˜èŒ</span><span class="status-value" id="level-value">å¸ƒè¡£</span></div>
        <div class="status-item"><span>ç²®è‰</span><span class="status-value" id="food-value">0</span></div>
    </div>

    <div class="main-container">
        <div class="game-area">
            <div class="image-container">
                <img src="" alt="æ¸¸æˆåœºæ™¯" class="game-image" id="game-image">
            </div>
            <div class="story-text" id="story-text">
                ä½ ä»ä¸€åœºæ··æ²Œçš„æ¢¦å¢ƒä¸­é†’æ¥ï¼Œè€³è¾¹æ˜¯åˆ€å‰‘ç¢°æ’çš„å–§åš£ä¸ç™¾å§“çš„å“€åšã€‚ä½ æ„è¯†åˆ°ï¼Œä½ å¹¶éèº«å¤„äºå¤ªå¹³ç››ä¸–ï¼Œè€Œæ˜¯æ¥åˆ°äº†ä¸€ä¸ªæˆ˜ç«çº·é£çš„å¹´ä»£â€”â€”ä¸œæ±‰æœ«å¹´ï¼Œç¾¤é›„å¹¶èµ·çš„ä¸‰å›½ä¹±ä¸–ã€‚åœ¨è¿™é‡Œï¼Œå¤©ä¸‹åˆ†å´©ç¦»æï¼Œæ°‘ä¸èŠç”Ÿï¼Œè€Œä½ ï¼Œå°†å¦‚ä½•åœ¨è¿™ä¹±ä¸–ä¸­ç«‹è¶³ï¼Œæˆå°±ä¸€ç•ªéœ¸ä¸šï¼Ÿä¸€ä¸ªå£°éŸ³åœ¨ä½ å¿ƒä¸­å›è¡ï¼šâ€œæ­¤ä¹ƒå¤©å‘½æ‰€å½’ï¼Œäº¦æ˜¯æ±ä¹‹æŠ‰æ‹©ã€‚é€‰æ‹©ä½ çš„å‡ºèº«ï¼Œå¼€å¯ä½ çš„ä¹±ä¸–å¾é€”å§ã€‚â€
            </div>
            <div class="choices-container" id="choices-container">
                <button class="choice-btn" data-choice="humble_villager">ğŸ¡ å¸ƒè¡£å‡ºèº«ï¼Œèƒ¸æ€€å¤©ä¸‹</button>
                <button class="choice-btn" data-choice="exiled_noble">ğŸ‘‘ è½é­„è´µæ—ï¼Œæ—§æ—¥ä½™æ™–</button>
                <button class="choice-btn" data-choice="loyal_retainer">âš”ï¸ å¿ ä¹‰ä¹‹å£«ï¼Œä¸ºå›½æ•ˆåŠ›</button>
                <button class="choice-btn" data-choice="cunning_strategist">ğŸ’¡ éšå±…è°‹å£«ï¼Œæ™ºå®šä¹¾å¤</button>
            </div>
        </div>

        <div class="sidebar">
            <div class="panel character-panel">
                <h2 class="panel-title">ä¸»å…¬ä¿¡æ¯</h2>
                <div class="character-info">
                    <div class="char-header">
                        <div class="char-icon">ğŸ‘‘</div>
                        <div id="char-name" class="char-name">æ— åä¸»å…¬</div>
                    </div>
                    <div class="health-bar">
                        <div id="health-bar" class="health-fill"></div>
                        <div id="health-text" class="health-text">å…µåŠ›: 0/0</div>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-item"><span>æ­¦åŠ›</span><span id="attack-value" class="stat-value">0</span></div>
                        <div class="stat-item"><span>ç»Ÿç‡</span><span id="defense-value" class="stat-value">0</span></div>
                        <div class="stat-item"><span>æ™ºåŠ›</span><span id="agility-value" class="stat-value">0</span></div>
                        <div class="stat-item"><span>æ”¿æ²»</span><span id="charm-value" class="stat-value">0</span></div>
                    </div>
                </div>
            </div>

            <div class="panel skills-panel">
                <h3 class="panel-title">å°†é¢†/ç­–ç•¥</h3>
                <div id="skills-list" class="scrollable-content">
                    <div class="item-text">æš‚æ— å°†é¢†æˆ–ç­–ç•¥</div>
                </div>
            </div>

            <div class="panel inventory-panel">
                <h3 class="panel-title">è¾é‡è¥</h3>
                <div id="items-grid" class="scrollable-content">
                    <div class="item-text">æš‚æ— è¾é‡</div>
                </div>
            </div>

            <div class="panel achievement-panel">
                <h3 class="panel-title">éœ¸ä¸šè½¨è¿¹</h3>
                <div id="achievement-list" class="scrollable-content">
                    <div class="achievement-text">å²å®˜å°šæœªæç¬”...</div>
                </div>
            </div>

            <div class="panel adventure-log-panel">
                <h3 class="panel-title">å²å®˜ç¬”è®°</h3>
                <div id="adventure-log" class="scrollable-content">
                    <div class="adventure-log-entry">ä½ çš„éœ¸ä¸šå³å°†å¼€å¯...</div>
                </div>
            </div>

            <button class="choice-btn" onclick="resetGame()">ğŸ”„ é‡ç½®æ¸¸æˆ</button>
        </div>
    </div>

    <footer>
        ç”± AI é©±åŠ¨çš„ä¸‰å›½ç­–ç•¥æ–‡å­—æ¸¸æˆ
    </footer>

    <script src="test-pollinations.js"></script>
    <script>
        // DOM å…ƒç´ å¼•ç”¨
        const storyText = document.getElementById('story-text');
        const choicesContainer = document.getElementById('choices-container');
        const gameImage = document.getElementById('game-image');
        const loadingOverlay = document.getElementById('loading-overlay');
        const loadingText = document.getElementById('loading-text');

        // çŠ¶æ€æ å…ƒç´ 
        const coinsEl = document.getElementById('coins-value');
        const reputationEl = document.getElementById('reputation-value');
        const levelEl = document.getElementById('level-value');
        const foodEl = document.getElementById('food-value'); // æ–°å¢ç²®è‰å…ƒç´ 

        // è§’è‰²ä¿¡æ¯é¢æ¿å…ƒç´ 
        const charName = document.getElementById('char-name');
        const healthBar = document.getElementById('health-bar');
        const healthText = document.getElementById('health-text');
        const attackEl = document.getElementById('attack-value');
        const defenseEl = document.getElementById('defense-value');
        const agilityEl = document.getElementById('agility-value');
        const charmEl = document.getElementById('charm-value');

        const skillsList = document.getElementById('skills-list');
        const itemsGrid = document.getElementById('items-grid');
        const achievementList = document.getElementById('achievement-list');
        const adventureLogEl = document.getElementById('adventure-log');

        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            charName: "æ— åä¸»å…¬",
            faction: null, // ç©å®¶æ‰€å±åŠ¿åŠ›ï¼Œå¦‚â€œæ— åâ€ã€â€œä¹‰å†›â€ã€â€œæ›¹æ“åŠ¿åŠ›â€ç­‰
            health: 1000, // å…µåŠ›
            maxHealth: 1000,
            attack: 60,   // æ­¦åŠ›
            defense: 60,  // ç»Ÿç‡
            agility: 60,  // æ™ºåŠ›
            charm: 60,    // æ”¿æ²»
            coins: 500,   // é‡‘é’±
            food: 1000,   // ç²®è‰ (æ–°å¢)
            reputation: 0, // å£°æœ›/æ°‘å¿ƒ
            level: 1, // å¯ä»¥ä»£è¡¨å®˜èŒç­‰çº§ï¼Œå¦‚1-10æ˜¯åœ°æ–¹å®˜ï¼Œ11-20æ˜¯å·ç‰§ç­‰
            skills: [ // åˆå§‹å°†é¢†/ç­–ç•¥
                {
                    name: "åŸºç¡€æ­¥æ³•",
                    description: "ç®€å•çš„æ­¥å…µæ“ç»ƒï¼Œæé«˜éƒ¨é˜Ÿçºªå¾‹æ€§",
                    icon: "fa-solid fa-person-military-rifle" // æ›´æ”¹å›¾æ ‡
                },
                {
                    name: "å¸‚äº•æƒ…æŠ¥",
                    description: "é€šè¿‡å¸‚äº•ä¼ é—»è·å–åŸºæœ¬ä¿¡æ¯",
                    icon: "fa-solid fa-magnifying-glass" // æ›´æ”¹å›¾æ ‡
                }
            ],
            items: [], // ç‰©å“/è£…å¤‡ï¼Œå¦‚â€œæ–¹å¤©ç”»æˆŸâ€ã€â€œèµ¤å…”é©¬â€ã€â€œé’å›Šä¹¦â€
            achievements: [ // æˆå°±ç³»ç»Ÿ
                { id: 'first_choice', text: 'ä¹±ä¸–åˆç°: åšå‡ºä½ çš„ç¬¬ä¸€ä¸ªé€‰æ‹©', unlocked: false },
                { id: 'first_battle', text: 'åˆæˆ˜å‘Šæ·: ç¬¬ä¸€æ¬¡èµ¢å¾—æˆ˜æ–—', unlocked: false },
                { id: 'recruit_general', text: 'æ…§çœ¼è¯†ç : æ‹›å‹Ÿç¬¬ä¸€ä½å°†é¢†', unlocked: false },
                { id: 'build_city', text: 'å¼€ç–†æ‹“åœŸ: å‘å±•ç¬¬ä¸€åº§åŸæ± ', unlocked: false },
                { id: 'unify_province', text: 'ä¸€ç»Ÿå·éƒ¡: ç»Ÿä¸€ä¸€ä¸ªå·çš„æ‰€æœ‰åŸæ± ', unlocked: false },
                { id: 'defeat_famous_general', text: 'æ–©å°†å¤ºæ——: å‡»è´¥ä¸€ä½è‘—åå°†é¢†', unlocked: false },
                { id: 'diplomatic_alliance', text: 'åˆçºµè¿æ¨ª: æˆåŠŸå»ºç«‹å¤–äº¤åŒç›Ÿ', unlocked: false },
                { id: 'rich_nation', text: 'å›½å¯Œæ°‘å¼º: æ‹¥æœ‰è¶…è¿‡50000é‡‘é’±', unlocked: false },
                { id: 'grand_strategist', text: 'è¿ç­¹å¸·å¹„: æˆåŠŸç­–åˆ’ä¸€æ¬¡å¤§å‹æˆ˜å½¹', unlocked: false },
                { id: 'emperor_coronation', text: 'å¤©ä¸‹å½’å¿ƒ: ç»Ÿä¸€å…¨å›½ï¼Œç™»åŸºç§°å¸', unlocked: false }
            ],
            adventureLog: [],
            turn: 0,
            currentScene: "start"
        };

        // åŠ è½½æ¸¸æˆçŠ¶æ€
        function loadGameState() {
            const savedState = localStorage.getItem('sanguoGameSave');
            if (savedState) {
                gameState = JSON.parse(savedState);
                addLog("æ¸¸æˆè¿›åº¦å·²åŠ è½½ã€‚");
            } else {
                addLog("å¼€å§‹æ–°çš„ä¸‰å›½å¾ç¨‹ã€‚");
            }
            updateUI();
            // ç¡®ä¿åˆå§‹å›¾ç‰‡åœ¨åŠ è½½æ—¶æ˜¾ç¤º
            if (!gameImage.src || gameImage.src.includes('data:image/gif') || gameImage.src.includes('about:blank')) {
                generateImage("A panoramic view of ancient China during the Three Kingdoms period, with distant mountains, a river, and smoke rising from a battlefield, in a traditional Chinese ink painting style.", "ä¸‰å›½ä¹±ä¸–åˆå§‹åœºæ™¯");
            }
        }

        // ä¿å­˜æ¸¸æˆçŠ¶æ€
        function saveGameState() {
            localStorage.setItem('sanguoGameSave', JSON.stringify(gameState));
        }

        // æ›´æ–° UI
        function updateUI() {
            charName.textContent = gameState.charName || 'æ— åä¸»å…¬'; // é»˜è®¤åç§°
            healthBar.style.width = `${(gameState.health / gameState.maxHealth) * 100}%`;
            healthText.textContent = `å…µåŠ›: ${gameState.health}/${gameState.maxHealth}`; // å…µåŠ›

            // æ›´æ–°é‡‘é’±ã€å£°æœ›ã€å®˜èŒå’Œç²®è‰
            coinsEl.textContent = gameState.coins;
            reputationEl.textContent = gameState.reputation;
            levelEl.textContent = getOfficialRank(gameState.level); // æ ¹æ®ç­‰çº§è·å–å®˜èŒ
            foodEl.textContent = gameState.food; // æ›´æ–°ç²®è‰

            // æ›´æ–°å±æ€§
            attackEl.textContent = gameState.attack; // æ­¦åŠ›
            defenseEl.textContent = gameState.defense; // ç»Ÿç‡
            agilityEl.textContent = gameState.agility; // æ™ºåŠ›
            charmEl.textContent = gameState.charm;     // æ”¿æ²»

            // æ›´æ–°æŠ€èƒ½/å°†é¢†
            skillsList.innerHTML = '';
            if (gameState.skills.length === 0) {
                skillsList.innerHTML = '<div class="item-text">æš‚æ— å°†é¢†æˆ–ç­–ç•¥</div>';
            } else {
                gameState.skills.forEach(skill => {
                    const skillItem = document.createElement('div');
                    skillItem.className = 'skill-item';
                    skillItem.innerHTML = `
                        <div class="skill-name"><i class="${skill.icon}"></i> ${skill.name}</div>
                        <div class="skill-description">${skill.description}</div>
                    `;
                    skillsList.appendChild(skillItem);
                });
            }


            // æ›´æ–°ç‰©å“/è¾é‡
            itemsGrid.innerHTML = '';
            if (gameState.items.length === 0) {
                itemsGrid.innerHTML = '<div class="item-text">æš‚æ— è¾é‡</div>';
            } else {
                gameState.items.forEach(item => {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'item-text';
                    itemElement.textContent = `${item.name} (${item.quantity})`;
                    itemsGrid.appendChild(itemElement);
                });
            }

            // æ›´æ–°æˆå°±/éœ¸ä¸šè½¨è¿¹
            achievementList.innerHTML = '';
            const unlockedAchievements = gameState.achievements.filter(a => a.unlocked);
            if (unlockedAchievements.length === 0) {
                achievementList.innerHTML = '<div class="achievement-text">æš‚æ— éœ¸ä¸šè½¨è¿¹</div>';
            } else {
                unlockedAchievements.forEach(ach => {
                    const achElement = document.createElement('div');
                    achElement.className = 'achievement-text';
                    achElement.textContent = `âœ… ${ach.text}`;
                    achievementList.appendChild(achElement);
                });
            }

            // æ›´æ–°å†’é™©æ—¥å¿—/å²å®˜ç¬”è®°
            adventureLogEl.innerHTML = '';
            if (gameState.adventureLog.length === 0) {
                adventureLogEl.innerHTML = '<div class="adventure-log-entry">å²å®˜å°šæœªæç¬”...</div>';
            } else {
                gameState.adventureLog.slice().reverse().forEach(log => { // æ˜¾ç¤ºæœ€æ–°æ—¥å¿—
                    const logEntry = document.createElement('div');
                    logEntry.className = 'adventure-log-entry';
                    logEntry.textContent = log;
                    adventureLogEl.appendChild(logEntry);
                });
            }

            saveGameState(); // æ¯æ¬¡æ›´æ–°UIåä¿å­˜æ¸¸æˆçŠ¶æ€
        }

        // è¾…åŠ©å‡½æ•°ï¼šæ ¹æ®ç­‰çº§è·å–å®˜èŒ
        function getOfficialRank(level) {
            if (level < 5) return "å¸ƒè¡£";
            if (level < 10) return "å¿ä»¤";
            if (level < 15) return "éƒ¡å®ˆ";
            if (level < 20) return "åˆºå²";
            if (level < 25) return "å·ç‰§";
            if (level < 30) return "å¤§å°†å†›";
            if (level < 35) return "ä¸ç›¸";
            return "å¤©å­"; // æœ€é«˜ç­‰çº§
        }

        // æ·»åŠ æ—¥å¿—
        function addLog(entry) {
            gameState.adventureLog.push(`å›åˆ ${gameState.turn + 1}: ${entry}`);
            // é™åˆ¶æ—¥å¿—æ¡æ•°ï¼Œä¾‹å¦‚åªä¿ç•™æœ€æ–°50æ¡
            if (gameState.adventureLog.length > 50) {
                gameState.adventureLog.splice(0, gameState.adventureLog.length - 50);
            }
            updateUI(); // å®æ—¶æ›´æ–°æ—¥å¿—
        }

        // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
        function showLoading(message) {
            loadingText.textContent = message;
            loadingOverlay.classList.add('visible');
        }

        // éšè—åŠ è½½åŠ¨ç”»
        function hideLoading() {
            loadingOverlay.classList.remove('visible');
        }

        // æ›´æ–°é€‰é¡¹
        function updateChoices(choices) {
            choicesContainer.innerHTML = '';
            if (choices && choices.length > 0) {
                choices.forEach(choice => {
                    const button = document.createElement('button');
                    button.className = 'choice-btn';
                    button.textContent = choice.text;
                    button.onclick = () => handleChoice(choice.target, choice.text);
                    choicesContainer.appendChild(button);
                });
            } else {
                // å¦‚æœæ²¡æœ‰æ›´å¤šé€‰é¡¹ï¼Œæä¾›ä¸€ä¸ªé‡æ–°å¼€å§‹çš„æŒ‰é’®
                storyText.textContent += "\n\nä¹±ä¸–æ— å¸¸ï¼Œå‰è·¯å·²æ–­ã€‚";
                const restartBtn = document.createElement('button');
                restartBtn.className = 'choice-btn';
                restartBtn.textContent = 'ğŸ”„ é‡æ–°å¼€å§‹';
                restartBtn.onclick = resetGame;
                choicesContainer.appendChild(restartBtn);
                choicesContainer.style.gridTemplateColumns = '1fr';
            }
        }

        // è§£é”æˆå°±
        function unlockAchievement(id) {
            const achievement = gameState.achievements.find(ach => ach.id === id);
            if (achievement && !achievement.unlocked) {
                achievement.unlocked = true;
                addLog(`æ­å–œï¼è§£é”æˆå°±ï¼š${achievement.text}`);
                updateUI();
            }
        }

        // åº”ç”¨AIç”Ÿæˆçš„æ•ˆæœ
        function applyEffects(effects) {
            if (!effects) return;
            for (const key in effects) {
                if (gameState.hasOwnProperty(key)) {
                    if (key === 'health') {
                        gameState.health = Math.max(0, Math.min(gameState.maxHealth, gameState.health + effects[key]));
                        addLog(`å…µåŠ›${effects[key] > 0 ? 'å¢åŠ ' : 'å‡å°‘'}äº† ${Math.abs(effects[key])}ã€‚`);
                    } else if (key === 'maxHealth') {
                        gameState.maxHealth += effects[key];
                        addLog(`æœ€å¤§å…µåŠ›ä¸Šé™${effects[key] > 0 ? 'æå‡' : 'é™ä½'}äº† ${Math.abs(effects[key])}ã€‚`);
                    }
                    else if (key === 'items' && Array.isArray(effects[key])) {
                        effects[key].forEach(newItem => {
                            const existingItem = gameState.items.find(item => item.name === newItem.name);
                            if (existingItem) {
                                existingItem.quantity = (existingItem.quantity || 1) + (newItem.quantity || 1);
                                addLog(`è·å¾—äº† ${newItem.quantity || 1} å•ä½çš„ ${newItem.name}ã€‚`);
                            } else {
                                gameState.items.push({ name: newItem.name, quantity: newItem.quantity || 1 });
                                addLog(`è·å¾—äº†ç‰©å“ï¼š${newItem.name}ã€‚`);
                            }
                        });
                    } else if (key === 'skills' && Array.isArray(effects[key])) {
                        effects[key].forEach(newSkill => {
                            if (!gameState.skills.some(s => s.name === newSkill.name)) {
                                gameState.skills.push(newSkill);
                                addLog(`å­¦ä¼šäº†æ–°çš„å°†é¢†/ç­–ç•¥ï¼š${newSkill.name}ã€‚`);
                                unlockAchievement('first_skill'); // å­¦ä¹ æ–°æŠ€èƒ½æˆå°±
                            }
                        });
                    } else if (key === 'achievements' && Array.isArray(effects[key])) {
                        effects[key].forEach(achId => unlockAchievement(achId));
                    } else if (key === 'level') { // å®˜èŒæå‡
                        gameState.level += effects[key];
                        addLog(`ä½ çš„å®˜èŒæå‡äº†ï¼ç°åœ¨æ˜¯ï¼š${getOfficialRank(gameState.level)}ã€‚`);
                    } else if (key === 'food') { // ç²®è‰å¢å‡
                        gameState.food = Math.max(0, gameState.food + effects[key]);
                        addLog(`ç²®è‰${effects[key] > 0 ? 'å¢åŠ ' : 'å‡å°‘'}äº† ${Math.abs(effects[key])}ã€‚`);
                    }
                    else {
                        gameState[key] += effects[key];
                        // é’ˆå¯¹ä¸åŒçš„å±æ€§æä¾›æ›´å…·ä½“çš„æ—¥å¿—
                        if (key === 'coins') addLog(`é‡‘é’±${effects[key] > 0 ? 'å¢åŠ ' : 'å‡å°‘'}äº† ${Math.abs(effects[key])}ã€‚`);
                        else if (key === 'reputation') addLog(`å£°æœ›${effects[key] > 0 ? 'æå‡' : 'ä¸‹é™'}äº† ${Math.abs(effects[key])}ã€‚`);
                        else if (key === 'attack') addLog(`æ­¦åŠ›${effects[key] > 0 ? 'æå‡' : 'ä¸‹é™'}äº† ${Math.abs(effects[key])}ã€‚`);
                        else if (key === 'defense') addLog(`ç»Ÿç‡${effects[key] > 0 ? 'æå‡' : 'ä¸‹é™'}äº† ${Math.abs(effects[key])}ã€‚`);
                        else if (key === 'agility') addLog(`æ™ºåŠ›${effects[key] > 0 ? 'æå‡' : 'ä¸‹é™'}äº† ${Math.abs(effects[key])}ã€‚`);
                        else if (key === 'charm') addLog(`æ”¿æ²»${effects[key] > 0 ? 'æå‡' : 'ä¸‹é™'}äº† ${Math.abs(effects[key])}ã€‚`);
                    }
                }
            }
            // æ£€æŸ¥å…µåŠ›æ˜¯å¦ä¸º0ï¼Œå¦‚æœæ˜¯åˆ™æ¸¸æˆç»“æŸ
            if (gameState.health <= 0) {
                storyText.textContent = "å…µè´¥å¦‚å±±å€’ï¼Œä½ éº¾ä¸‹å°†å£«æ‰€å‰©æ— å‡ ï¼Œéœ¸ä¸šä¹‹è·¯æˆ›ç„¶è€Œæ­¢ã€‚";
                choicesContainer.innerHTML = '';
                const restartBtn = document.createElement('button');
                restartBtn.className = 'choice-btn';
                restartBtn.textContent = 'ğŸ”„ é‡æ–°å¼€å§‹';
                restartBtn.onclick = resetGame;
                choicesContainer.appendChild(restartBtn);
                choicesContainer.style.gridTemplateColumns = '1fr';
                addLog("ä½ çš„éœ¸ä¸šå·²ç»ˆç»“ã€‚");
                unlockAchievement('game_over'); // å¯ä»¥æ·»åŠ ä¸€ä¸ªâ€œæ¸¸æˆç»“æŸâ€çš„æˆå°±
            }
        }


        // å¤„ç†ç©å®¶é€‰æ‹©
        async function handleChoice(choice, choiceText) {
            showLoading('æ­£åœ¨åˆ†æä¹±ä¸–å±€åŠ¿...'); // åŠ è½½æç¤º
            addLog(`é€‰æ‹©äº†ï¼š${choiceText}`); // æ·»åŠ åˆ°æ—¥å¿—

            let prompt = "";
            let imagePrompt = ""; // ç”¨äºåˆå§‹é€‰æ‹©çš„ç‰¹å®šå›¾ç‰‡æç¤º

            // å¤„ç†åˆå§‹é€‰æ‹©
            if (gameState.currentScene === "start") {
                let initialStoryPrompt = "";
                switch (choice) {
                    case "humble_villager":
                        gameState.charName = "åˆ˜" + String.fromCharCode(0x4E00 + Math.floor(Math.random() * 20000)); // éšæœºåŒ–ä¸€ä¸ªæ±‰å­—ä½œä¸ºåå­—
                        gameState.attack += 5; gameState.defense += 10; gameState.coins += 100; gameState.food += 500;
                        initialStoryPrompt = `ä½ ä½œä¸ºä¸€åå¸ƒè¡£å¹³æ°‘ï¼Œåœ¨ä¹±ä¸–ä¸­è‰°éš¾æ±‚ç”Ÿï¼Œä½†èƒ¸æ€€å¤§å¿—ã€‚ä½ æ¥ä¸‹æ¥ä¼šå¦‚ä½•è¡ŒåŠ¨ï¼Ÿæä¾›ä¸€ä¸ªå…³äºä½ åˆå…¥ä¹±ä¸–çš„æ•…äº‹å¼€ç«¯ï¼Œå¹¶ç»™å‡º2-3ä¸ªè¡ŒåŠ¨é€‰é¡¹ã€‚`;
                        imagePrompt = "A humble villager in a war-torn Chinese village, ink wash painting style, Three Kingdoms era";
                        break;
                    case "exiled_noble":
                        gameState.charName = "è¢" + String.fromCharCode(0x4E00 + Math.floor(Math.random() * 20000));
                        gameState.charm += 10; gameState.coins += 500; gameState.reputation += 20;
                        initialStoryPrompt = `ä½ æ›¾æ˜¯æ˜¾èµ«è´µæ—ä¹‹åï¼Œå®¶æ—è¡°è½åä½ æµè½æ°‘é—´ï¼Œä½†ä»æœ‰ä¸€å®šå½±å“åŠ›ã€‚ä½ æ¥ä¸‹æ¥ä¼šå¦‚ä½•è¡ŒåŠ¨ï¼Ÿæä¾›ä¸€ä¸ªå…³äºä½ å¦‚ä½•åœ¨ä¹±ä¸–ä¸­é‡æŒ¯å®¶æ—å£°å¨çš„æ•…äº‹å¼€ç«¯ï¼Œå¹¶ç»™å‡º2-3ä¸ªè¡ŒåŠ¨é€‰é¡¹ã€‚`;
                        imagePrompt = "An exiled Chinese noble in simple clothes, but with a dignified demeanor, Three Kingdoms era";
                        break;
                    case "loyal_retainer":
                        gameState.charName = "èµµ" + String.fromCharCode(0x4E00 + Math.floor(Math.random() * 20000));
                        gameState.attack += 15; gameState.defense += 5; gameState.health += 200; gameState.maxHealth += 200;
                        initialStoryPrompt = `ä½ æ˜¯ä¸€åå¿ ä¹‰ä¹‹å£«ï¼Œæ¸´æœ›åœ¨ä¹±ä¸–ä¸­å¯»è§…æ˜ä¸»ï¼ŒæŠ¥æ•ˆå›½å®¶ã€‚ä½ æ¥ä¸‹æ¥ä¼šå¦‚ä½•è¡ŒåŠ¨ï¼Ÿæä¾›ä¸€ä¸ªå…³äºä½ åˆæ¬¡å±•ç°æ­¦å‹‡ï¼Œå¯»è®¿æ˜ä¸»çš„æ•…äº‹å¼€ç«¯ï¼Œå¹¶ç»™å‡º2-3ä¸ªè¡ŒåŠ¨é€‰é¡¹ã€‚`;
                        imagePrompt = "A loyal Chinese warrior, armed with a spear, standing firm amidst chaos, Three Kingdoms era";
                        break;
                    case "cunning_strategist":
                        gameState.charName = "è¯¸è‘›" + String.fromCharCode(0x4E00 + Math.floor(Math.random() * 20000));
                        gameState.agility += 15; gameState.charm += 5; gameState.reputation += 10;
                        initialStoryPrompt = `ä½ æ˜¯ä¸€åéšå±…æ·±å±±çš„è°‹å£«ï¼Œæ´å¯Ÿå¤©ä¸‹å¤§åŠ¿ï¼Œç­‰å¾…æ—¶æœºã€‚ä½ æ¥ä¸‹æ¥ä¼šå¦‚ä½•è¡ŒåŠ¨ï¼Ÿæä¾›ä¸€ä¸ªå…³äºä½ å¦‚ä½•å‡ºå±±è¾…ä½æ˜ä¸»ï¼Œæˆ–ç‹¬è‡ªæ–½å±•æ™ºè°‹çš„æ•…äº‹å¼€ç«¯ï¼Œå¹¶ç»™å‡º2-3ä¸ªè¡ŒåŠ¨é€‰é¡¹ã€‚`;
                        imagePrompt = "A reclusive Chinese strategist in a bamboo forest, with a feather fan, Three Kingdoms era";
                        break;
                }
                prompt = `ä½ ç°åœ¨æ˜¯ã€Šä¸‰å›½å¿—ï¼šä¹±ä¸–äº‰é›„ã€‹çš„AIæ¸¸æˆå¼•æ“ï¼Œä½ çš„ä»»åŠ¡æ˜¯æ ¹æ®ç©å®¶çš„é€‰æ‹©ï¼Œç”Ÿæˆå¼•äººå…¥èƒœã€ç¬¦åˆä¸‰å›½å†å²èƒŒæ™¯ï¼ˆæˆ–æ¼”ä¹‰è®¾å®šï¼‰çš„æ•…äº‹æƒ…èŠ‚å’Œåˆç†çš„è¡ŒåŠ¨é€‰é¡¹ã€‚è¯·ç¡®ä¿å›å¤æ˜¯æœ‰æ•ˆçš„JSONæ ¼å¼ã€‚
                
                å½“å‰ç©å®¶è§’è‰²æ˜¯ã€${gameState.charName}ã€‘ï¼Œå‡ºèº«ä¸ºã€${choiceText}ã€‘ã€‚
                ä½ é€‰æ‹©${choiceText}ï¼Œ${initialStoryPrompt} 
                
                è¯·æä¾›ä¸€ä¸ªJSONå¯¹è±¡ï¼ŒåŒ…å«ä»¥ä¸‹å­—æ®µï¼š
                - "story": æè¿°å½“å‰åœºæ™¯å’Œæ•…äº‹è¿›å±•çš„æ–‡å­—ã€‚
                - "choices": ä¸€ä¸ªåŒ…å«2-4ä¸ªè¡ŒåŠ¨é€‰é¡¹çš„æ•°ç»„ï¼Œæ¯ä¸ªé€‰é¡¹åº”åŒ…å«"text"ï¼ˆé€‰é¡¹æ–‡æœ¬ï¼‰å’Œ"target"ï¼ˆè¯¥é€‰é¡¹çš„å†…éƒ¨æ ‡è¯†ç¬¦ï¼‰ã€‚
                - "imagePrompt" (å¯é€‰): ç”¨äºç”Ÿæˆå½“å‰åœºæ™¯å›¾ç‰‡ï¼ˆä¸‰å›½é£æ ¼ï¼‰çš„è‹±æ–‡æç¤ºè¯ã€‚
                - "effects" (å¯é€‰): ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«å¯¹æ¸¸æˆçŠ¶æ€çš„ä¿®æ”¹ï¼ˆå¦‚{"coins": 100, "attack": 5, "items": [{"name": "é’å›Šä¹¦", "quantity": 1}], "achievements": ["recruit_general"]}ï¼‰ã€‚å¯ä¿®æ”¹çš„å±æ€§åŒ…æ‹¬ï¼šhealth, maxHealth, attack, defense, agility, charm, coins, food, reputation, level, skills, items, achievementsã€‚
                `;
                gameState.currentScene = choice; // æ›´æ–°å½“å‰åœºæ™¯
                unlockAchievement('first_choice'); // è§£é”æˆå°±
            } else {
                // åç»­å›åˆçš„AIæç¤ºè¯
                prompt = `ä½ ç°åœ¨æ˜¯ã€Šä¸‰å›½å¿—ï¼šä¹±ä¸–äº‰é›„ã€‹çš„AIæ¸¸æˆå¼•æ“ï¼Œä½ çš„ä»»åŠ¡æ˜¯æ ¹æ®ç©å®¶çš„é€‰æ‹©ï¼Œç”Ÿæˆå¼•äººå…¥èƒœã€ç¬¦åˆä¸‰å›½å†å²èƒŒæ™¯ï¼ˆæˆ–æ¼”ä¹‰è®¾å®šï¼‰çš„æ•…äº‹æƒ…èŠ‚å’Œåˆç†çš„è¡ŒåŠ¨é€‰é¡¹ã€‚è¯·ç¡®ä¿å›å¤æ˜¯æœ‰æ•ˆçš„JSONæ ¼å¼ã€‚
                
                å½“å‰ç©å®¶è§’è‰²æ˜¯ã€${gameState.charName}ã€‘ï¼Œèº«ä»½æ˜¯ã€${getOfficialRank(gameState.level)}ã€‘ã€‚
                ä½ æ‹¥æœ‰çš„å±æ€§ï¼šæ­¦åŠ›${gameState.attack}ï¼Œç»Ÿç‡${gameState.defense}ï¼Œæ™ºåŠ›${gameState.agility}ï¼Œæ”¿æ²»${gameState.charm}ã€‚
                é‡‘é’±ï¼š${gameState.coins}ï¼Œç²®è‰ï¼š${gameState.food}ï¼Œå…µåŠ›ï¼š${gameState.health}/${gameState.maxHealth}ã€‚
                å£°æœ›ï¼š${gameState.reputation}ã€‚
                ä½ ç›®å‰çš„å°†é¢†å’Œç­–ç•¥æœ‰ï¼š${gameState.skills.map(s => s.name).join('ï¼Œ') || 'æ— ' }ã€‚
                ä½ æœ€è¿‘ç»å†äº†ï¼šâ€œ${storyText.textContent.substring(0, Math.min(storyText.textContent.length, 200))}...â€ã€‚
                ä½ é€‰æ‹©äº†â€œ${choiceText}â€ã€‚
                
                è¯·æ ¹æ®è¿™ä¸ªé€‰æ‹©å’Œå½“å‰æ¸¸æˆçŠ¶æ€ï¼Œç”Ÿæˆæ¥ä¸‹æ¥çš„ä¸‰å›½æ•…äº‹å†…å®¹ï¼Œå¹¶ç»™å‡º2-3ä¸ªæ–°çš„è¡ŒåŠ¨é€‰é¡¹ã€‚ç€é‡å¼ºè°ƒä¸‰å›½æ—¶æœŸçš„æ”¿æ²»æ–—äº‰ã€å†›äº‹å†²çªã€äººç‰©äº’åŠ¨ã€å†…æ”¿å‘å±•ã€å¥‡é‡ã€æ‹›å‹Ÿå°†é¢†ã€æ”»åŸç•¥åœ°ç­‰å…ƒç´ ã€‚
                
                è¯·æä¾›ä¸€ä¸ªJSONå¯¹è±¡ï¼ŒåŒ…å«ä»¥ä¸‹å­—æ®µï¼š
                - "story": æè¿°å½“å‰åœºæ™¯å’Œæ•…äº‹è¿›å±•çš„æ–‡å­—ã€‚
                - "choices": ä¸€ä¸ªåŒ…å«2-4ä¸ªè¡ŒåŠ¨é€‰é¡¹çš„æ•°ç»„ï¼Œæ¯ä¸ªé€‰é¡¹åº”åŒ…å«"text"ï¼ˆé€‰é¡¹æ–‡æœ¬ï¼‰å’Œ"target"ï¼ˆè¯¥é€‰é¡¹çš„å†…éƒ¨æ ‡è¯†ç¬¦ï¼‰ã€‚
                - "imagePrompt" (å¯é€‰): ç”¨äºç”Ÿæˆå½“å‰åœºæ™¯å›¾ç‰‡ï¼ˆä¸‰å›½é£æ ¼ï¼‰çš„è‹±æ–‡æç¤ºè¯ã€‚
                - "effects" (å¯é€‰): ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«å¯¹æ¸¸æˆçŠ¶æ€çš„ä¿®æ”¹ï¼ˆå¦‚{"coins": 100, "attack": 5, "items": [{"name": "é’å›Šä¹¦", "quantity": 1}], "achievements": ["recruit_general"]}ï¼‰ã€‚å¯ä¿®æ”¹çš„å±æ€§åŒ…æ‹¬ï¼šhealth, maxHealth, attack, defense, agility, charm, coins, food, reputation, level, skills, items, achievementsã€‚
                `;
            }

            try {
                const result = await promptLLM(prompt, "ä¸‰å›½æ•…äº‹ç”Ÿæˆ"); // ä¼ é€’ä¸€ä¸ªæè¿°æ€§çš„ä»»åŠ¡å
                if (result && result.story) {
                    storyText.textContent = result.story;
                    updateChoices(result.choices);

                    // ä¼˜å…ˆä½¿ç”¨AIç”Ÿæˆçš„imagePromptï¼Œå¦åˆ™ä½¿ç”¨åˆå§‹é€‰æ‹©çš„imagePrompt
                    if (result.imagePrompt) {
                        await generateImage(result.imagePrompt, "ä¸‰å›½åœºæ™¯å›¾ç‰‡");
                    } else if (imagePrompt) { // å¦‚æœåˆå§‹é€‰æ‹©æœ‰ç‰¹å®šå›¾ç‰‡æç¤º
                        await generateImage(imagePrompt, "ä¸‰å›½äººç‰©å›¾ç‰‡");
                    } else {
                        // å¦‚æœAIæ²¡æœ‰æä¾›ï¼Œä¸”æ²¡æœ‰åˆå§‹å›¾ç‰‡æç¤ºï¼Œå¯ä»¥å°è¯•æ ¹æ®æ•…äº‹å†…å®¹ç”Ÿæˆä¸€ä¸ªé€šç”¨å›¾ç‰‡æç¤º
                        await generateImage("An atmospheric scene from the Three Kingdoms era, illustrating the story: " + result.story.substring(0, Math.min(result.story.length, 50)), "ä¸‰å›½åœºæ™¯å›¾ç‰‡");
                    }

                    // åº”ç”¨æ•ˆæœ
                    if (result.effects) {
                        applyEffects(result.effects);
                    }
                    addLog(result.story); // å°†æ–°æ•…äº‹æ·»åŠ åˆ°æ—¥å¿—
                    gameState.turn++; // å¢åŠ å›åˆæ•°
                    updateUI();
                } else {
                    console.error("AIç”Ÿæˆç»“æœæ— æ•ˆ:", result);
                    storyText.textContent = "ä¼¼ä¹å‘ç”Ÿäº†æ—¶ç©ºé”™ä¹±ï¼Œè¯·é‡æ–°é€‰æ‹©æˆ–é‡ç½®æ¸¸æˆã€‚";
                    updateChoices([{ text: "é‡ç½®æ¸¸æˆ", target: "reset" }]);
                }
            } catch (error) {
                console.error("å¤„ç†é€‰æ‹©æ—¶å‘ç”Ÿé”™è¯¯:", error);
                storyText.textContent = "ä¹±ä¸–è¿·é›¾ç¬¼ç½©ï¼Œæ— æ³•çœ‹æ¸…å‰è·¯ã€‚è¯·æ£€æŸ¥APIè®¾ç½®æˆ–é‡è¯•ã€‚";
                updateChoices([{ text: "é‡ç½®æ¸¸æˆ", target: "reset" }]);
            } finally {
                hideLoading();
            }
        }

        // é‡ç½®æ¸¸æˆ
        async function resetGame() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ¸¸æˆå—ï¼Ÿè¿™å°†æ¸…é™¤æ‰€æœ‰è¿›åº¦ï¼Œæ— æ³•æ¢å¤ï¼')) {
                localStorage.removeItem('sanguoGameSave'); // æ›´æ”¹ä¿å­˜åç§°
                // é‡ç½®æ¸¸æˆçŠ¶æ€åˆ°åˆå§‹å€¼
                gameState = {
                    charName: "æ— åä¸»å…¬",
                    faction: null,
                    health: 1000,
                    maxHealth: 1000,
                    attack: 60,
                    defense: 60,
                    agility: 60,
                    charm: 60,
                    coins: 500,
                    food: 1000,
                    reputation: 0,
                    level: 1,
                    skills: [
                        { name: "åŸºç¡€æ­¥æ³•", description: "ç®€å•çš„æ­¥å…µæ“ç»ƒï¼Œæé«˜éƒ¨é˜Ÿçºªå¾‹æ€§", icon: "fa-solid fa-person-military-rifle" },
                        { name: "å¸‚äº•æƒ…æŠ¥", description: "é€šè¿‡å¸‚äº•ä¼ é—»è·å–åŸºæœ¬ä¿¡æ¯", icon: "fa-solid fa-magnifying-glass" }
                    ],
                    items: [],
                    achievements: gameState.achievements.map(ach => ({ ...ach, unlocked: false })), // é‡ç½®æ‰€æœ‰æˆå°±ä¸ºæœªè§£é”
                    adventureLog: [],
                    turn: 0,
                    currentScene: "start"
                };

                // é‡ç½®ç•Œé¢åˆ°åˆå§‹çŠ¶æ€
                storyText.textContent = 'ä½ ä»ä¸€åœºæ··æ²Œçš„æ¢¦å¢ƒä¸­é†’æ¥ï¼Œè€³è¾¹æ˜¯åˆ€å‰‘ç¢°æ’çš„å–§åš£ä¸ç™¾å§“çš„å“€åšã€‚ä½ æ„è¯†åˆ°ï¼Œä½ å¹¶éèº«å¤„äºå¤ªå¹³ç››ä¸–ï¼Œè€Œæ˜¯æ¥åˆ°äº†ä¸€ä¸ªæˆ˜ç«çº·é£çš„å¹´ä»£â€”â€”ä¸œæ±‰æœ«å¹´ï¼Œç¾¤é›„å¹¶èµ·çš„ä¸‰å›½ä¹±ä¸–ã€‚åœ¨è¿™é‡Œï¼Œå¤©ä¸‹åˆ†å´©ç¦»æï¼Œæ°‘ä¸èŠç”Ÿï¼Œè€Œä½ ï¼Œå°†å¦‚ä½•åœ¨è¿™ä¹±ä¸–ä¸­ç«‹è¶³ï¼Œæˆå°±ä¸€ç•ªéœ¸ä¸šï¼Ÿä¸€ä¸ªå£°éŸ³åœ¨ä½ å¿ƒä¸­å›è¡ï¼šâ€œæ­¤ä¹ƒå¤©å‘½æ‰€å½’ï¼Œäº¦æ˜¯æ±ä¹‹æŠ‰æ‹©ã€‚é€‰æ‹©ä½ çš„å‡ºèº«ï¼Œå¼€å¯ä½ çš„ä¹±ä¸–å¾é€”å§ã€‚â€';
                choicesContainer.innerHTML = `
                    <button class="choice-btn" data-choice="humble_villager">ğŸ¡ å¸ƒè¡£å‡ºèº«ï¼Œèƒ¸æ€€å¤©ä¸‹</button>
                    <button class="choice-btn" data-choice="exiled_noble">ğŸ‘‘ è½é­„è´µæ—ï¼Œæ—§æ—¥ä½™æ™–</button>
                    <button class="choice-btn" data-choice="loyal_retainer">âš”ï¸ å¿ ä¹‰ä¹‹å£«ï¼Œä¸ºå›½æ•ˆåŠ›</button>
                    <button class="choice-btn" data-choice="cunning_strategist">ğŸ’¡ éšå±…è°‹å£«ï¼Œæ™ºå®šä¹¾å¤</button>
                `;
                // é‡ç½®åœºæ™¯å›¾ç‰‡ä¸ºä¸‰å›½ä¸»é¢˜çš„åˆå§‹å›¾ç‰‡
                const initialImagePrompt = "A panoramic view of ancient China during the Three Kingdoms period, with distant mountains, a river, and smoke rising from a battlefield, in a traditional Chinese ink painting style.";
                try {
                    await generateImage(initialImagePrompt, "ä¸‰å›½ä¹±ä¸–åˆå§‹åœºæ™¯"); // å¢åŠ ä»»åŠ¡æè¿°
                } catch (error) {
                    console.error("é‡ç½®æ—¶å›¾ç‰‡åŠ è½½å¤±è´¥:", error);
                }
                updateUI();
                alert('æ¸¸æˆå·²é‡ç½®ï¼');
                addLog("æ¸¸æˆå·²é‡ç½®ï¼Œæ–°çš„å¾ç¨‹å¼€å§‹ï¼");
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆæ—¶æ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', () => {
            loadGameState();
            // ä¸ºåˆå§‹æŒ‰é’®æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            choicesContainer.addEventListener('click', (event) => {
                if (event.target.classList.contains('choice-btn')) {
                    const choice = event.target.dataset.choice;
                    const choiceText = event.target.textContent;
                    // ç¡®ä¿åªæœ‰åœ¨å½“å‰åœºæ™¯æ˜¯"start"æ—¶æ‰å…è®¸åˆå§‹é€‰æ‹©
                    if (gameState.currentScene === "start" || choice === "reset") { // å…è®¸é‡ç½®
                        handleChoice(choice, choiceText);
                    }
                }
            });
        });
    </script>
</body>
</html>
